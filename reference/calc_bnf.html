<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Calculate Total Biological Nitrogen Fixation — calc_bnf • afsetools</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Calculate Total Biological Nitrogen Fixation — calc_bnf"><meta name="description" content="Total BNF is the sum of three components:
$$BNF = CropBNF + WeedsBNF + NSBNF$$
Each component is estimated using reference parameters from the BNF
data table, optionally adjusted for local environmental conditions
(N inputs, temperature, moisture, SOM, pH) when these variables are
present in the input data.
**When no environmental columns are present**, the function produces
results comparable to `Calc_N_fix()` (all adjustment factors = 1),
ensuring backward compatibility."><meta property="og:description" content="Total BNF is the sum of three components:
$$BNF = CropBNF + WeedsBNF + NSBNF$$
Each component is estimated using reference parameters from the BNF
data table, optionally adjusted for local environmental conditions
(N inputs, temperature, moisture, SOM, pH) when these variables are
present in the input data.
**When no environmental columns are present**, the function produces
results comparable to `Calc_N_fix()` (all adjustment factors = 1),
ensuring backward compatibility."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">afsetools</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/eduaguilera/afsetools/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Calculate Total Biological Nitrogen Fixation</h1>
      <small class="dont-index">Source: <a href="https://github.com/eduaguilera/afsetools/blob/main/R/bnf_functions.R" class="external-link"><code>R/bnf_functions.R</code></a></small>
      <div class="d-none name"><code>calc_bnf.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Total BNF is the sum of three components:
$$BNF = CropBNF + WeedsBNF + NSBNF$$</p>
<p>Each component is estimated using reference parameters from the BNF
data table, optionally adjusted for local environmental conditions
(N inputs, temperature, moisture, SOM, pH) when these variables are
present in the input data.</p>
<p>**When no environmental columns are present**, the function produces
results comparable to `Calc_N_fix()` (all adjustment factors = 1),
ensuring backward compatibility.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">calc_bnf</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  k_n_symb_synth <span class="op">=</span> <span class="fl">0.0035</span>,</span>
<span>  k_n_symb_org <span class="op">=</span> <span class="fl">0.0018</span>,</span>
<span>  k_n_ns_synth <span class="op">=</span> <span class="fl">0.005</span>,</span>
<span>  k_n_ns_org <span class="op">=</span> <span class="fl">0.0025</span>,</span>
<span>  t_opt <span class="op">=</span> <span class="fl">25</span>,</span>
<span>  t_sigma_symb <span class="op">=</span> <span class="fl">8</span>,</span>
<span>  t_sigma_ns <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  nsbnf_default_kgha <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  k_som <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  som_ref <span class="op">=</span> <span class="fl">2.5</span>,</span>
<span>  ph_opt <span class="op">=</span> <span class="fl">6.8</span>,</span>
<span>  ph_sigma <span class="op">=</span> <span class="fl">1.5</span>,</span>
<span>  k_clay <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  clay_ref <span class="op">=</span> <span class="fl">25</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>Data frame with crop NPP and area data. Required columns:</p><dl><dt>Name_biomass</dt>
<dd><p>Crop name matching Names_BNF.</p></dd>

    <dt>Crop_NPP_MgN</dt>
<dd><p>Crop NPP in Mg N.</p></dd>

    <dt>Prod_MgN</dt>
<dd><p>Product nitrogen in Mg.</p></dd>

    <dt>Weeds_NPP_MgN</dt>
<dd><p>Weed NPP in Mg N.</p></dd>

    <dt>LandUse</dt>
<dd><p>Land use type (Cropland, etc.).</p></dd>

    <dt>Area_ygpit_ha</dt>
<dd><p>Harvested area in hectares.</p></dd>

    <dt>Legs_Seeded</dt>
<dd><p>Legume fraction in seeded cover crops.</p></dd>

    <dt>Seeded_CC_share</dt>
<dd><p>Share of area with seeded CCs.</p></dd>


</dl><p>Optional environmental columns (auto-detected):</p><dl><dt>N_synth_kgha</dt>
<dd><p>Synthetic N fertilizer (kg N/ha).</p></dd>

    <dt>N_org_kgha</dt>
<dd><p>Organic N inputs (kg N/ha).</p></dd>

    <dt>TMP</dt>
<dd><p>Mean temperature (degrees C).</p></dd>

    <dt>WaterInput_mm</dt>
<dd><p>Water input (mm). Or provide precip_mm
      and optionally irrig_mm.</p></dd>

    <dt>PET_mm</dt>
<dd><p>Potential evapotranspiration (mm).</p></dd>

    <dt>SOM_pct</dt>
<dd><p>Soil organic matter (percent).</p></dd>

    <dt>soil_pH</dt>
<dd><p>Soil pH.</p></dd>


</dl></dd>


<dt id="arg-k-n-symb-synth">k_n_symb_synth<a class="anchor" aria-label="anchor" href="#arg-k-n-symb-synth"></a></dt>
<dd><p>Numeric. Synthetic N inhibition constant
for symbiotic BNF (default 0.0035).</p></dd>


<dt id="arg-k-n-symb-org">k_n_symb_org<a class="anchor" aria-label="anchor" href="#arg-k-n-symb-org"></a></dt>
<dd><p>Numeric. Organic N inhibition constant
for symbiotic BNF (default 0.0018).</p></dd>


<dt id="arg-k-n-ns-synth">k_n_ns_synth<a class="anchor" aria-label="anchor" href="#arg-k-n-ns-synth"></a></dt>
<dd><p>Numeric. Synthetic N inhibition constant
for non-symbiotic BNF (default 0.005).</p></dd>


<dt id="arg-k-n-ns-org">k_n_ns_org<a class="anchor" aria-label="anchor" href="#arg-k-n-ns-org"></a></dt>
<dd><p>Numeric. Organic N inhibition constant
for non-symbiotic BNF (default 0.0025).</p></dd>


<dt id="arg-t-opt">t_opt<a class="anchor" aria-label="anchor" href="#arg-t-opt"></a></dt>
<dd><p>Numeric. Optimal temperature (default 25).</p></dd>


<dt id="arg-t-sigma-symb">t_sigma_symb<a class="anchor" aria-label="anchor" href="#arg-t-sigma-symb"></a></dt>
<dd><p>Numeric. Temperature width for symbiotic
(default 8).</p></dd>


<dt id="arg-t-sigma-ns">t_sigma_ns<a class="anchor" aria-label="anchor" href="#arg-t-sigma-ns"></a></dt>
<dd><p>Numeric. Temperature width for non-symbiotic
(default 10).</p></dd>


<dt id="arg-nsbnf-default-kgha">nsbnf_default_kgha<a class="anchor" aria-label="anchor" href="#arg-nsbnf-default-kgha"></a></dt>
<dd><p>Numeric. Default NSBNF base rate
(default 5 kg N/ha/yr).</p></dd>


<dt id="arg-k-som">k_som<a class="anchor" aria-label="anchor" href="#arg-k-som"></a></dt>
<dd><p>Numeric. SOM half-saturation (default 2.0).</p></dd>


<dt id="arg-som-ref">som_ref<a class="anchor" aria-label="anchor" href="#arg-som-ref"></a></dt>
<dd><p>Numeric. Reference SOM (default 2.5).</p></dd>


<dt id="arg-ph-opt">ph_opt<a class="anchor" aria-label="anchor" href="#arg-ph-opt"></a></dt>
<dd><p>Numeric. Optimal pH (default 6.8).</p></dd>


<dt id="arg-ph-sigma">ph_sigma<a class="anchor" aria-label="anchor" href="#arg-ph-sigma"></a></dt>
<dd><p>Numeric. pH Gaussian width (default 1.5).</p></dd>


<dt id="arg-k-clay">k_clay<a class="anchor" aria-label="anchor" href="#arg-k-clay"></a></dt>
<dd><p>Numeric. Clay half-saturation for NSBNF (default
20).</p></dd>


<dt id="arg-clay-ref">clay_ref<a class="anchor" aria-label="anchor" href="#arg-clay-ref"></a></dt>
<dd><p>Numeric. Reference clay percent (default 25).</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>Data frame with all intermediate columns plus:</p><dl><dt>Fert_type</dt>
<dd><p>"BNF" character flag.</p></dd>

    <dt>CropBNF</dt>
<dd><p>Symbiotic crop BNF, NPP method (Mg N).</p></dd>

    <dt>CropBNF2</dt>
<dd><p>Symbiotic crop BNF, Anglade method (Mg N).</p></dd>

    <dt>WeedsBNF</dt>
<dd><p>Symbiotic weed/cover crop BNF (Mg N).</p></dd>

    <dt>NSBNF</dt>
<dd><p>Non-symbiotic BNF (Mg N).</p></dd>

    <dt>BNF</dt>
<dd><p>Total BNF (Mg N).</p></dd>

    <dt>f_N_symb, f_temp_symb, f_water_symb</dt>
<dd><p>Symbiotic
      adjustment factors.</p></dd>

    <dt>f_N_ns, f_temp_ns, f_water_ns, f_SOM_ns,
      f_pH_ns, f_clay_ns</dt>
<dd><p>Non-symbiotic adjustment factors.</p></dd>


</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Master function that calculates all BNF components (symbiotic crop,
symbiotic weed/cover crop, and non-symbiotic) using literature-based
environmental modifiers. Replaces and improves upon `Calc_N_fix()`.</p>

<p>## Symbiotic BNF (crop legumes)</p>
<p>Two methods are calculated in parallel:
- **NPP method**: Uses total crop NPP nitrogen and Ndfa.
- **Anglade method**: Uses product nitrogen with below-ground N
  (BGN) and N harvest index (NHI) corrections.</p>
<p>Ndfa is adjusted for N fertilization, temperature, and water.</p>
<p>## Symbiotic BNF (weeds and cover crops)</p>
<p>Based on weed NPP nitrogen, with legume share as a weighted
average of spontaneous weeds and seeded cover crops. Same
environmental adjustments as crop legume BNF.</p>
<p>## Non-symbiotic BNF</p>
<p>Base rate from BNF table (rice 33, sugarcane 25 kg N/ha/yr) or
default (5 kg N/ha/yr). Adjusted for:
- N inputs (free-living fixers avoid fixation cost when N
  available)
- Temperature (broad Gaussian, sigma = 10)
- Water (aridity index threshold)
- SOM (C energy for heterotrophic fixers, Michaelis-Menten)
- pH (Gaussian around 6.8)</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Anglade J et al. (2015) Nutr. Cycl. Agroecosyst. 103:37-56.</p>
<p>Cleveland CC et al. (1999) Global Biogeochem. Cycles 13:623-645.</p>
<p>Dynarski KA, Houlton BZ (2018) New Phytologist 217:68-85.</p>
<p>Herridge DF et al. (2008) Plant and Soil 311:1-18.</p>
<p>Hungria M, Vargas MAT (2000) Field Crops Res. 65:151-164.</p>
<p>Ladha JK et al. (2016) Scientific Reports 6:19355.</p>
<p>Peoples MB et al. (2009) Symbiosis 48:1-17.</p>
<p>Reed SC et al. (2011) Annu. Rev. Ecol. Evol. Syst. 42:489-512.</p>
<p>Salvagiotti F et al. (2008) Field Crops Res. 108:1-13.</p>
<p>Serraj R et al. (1999) Plant Physiology 120:577-586.</p>
<p>Urquiaga S et al. (2012) Plant and Soil 356:5-21.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="calc_crop_bnf.html">calc_crop_bnf</a></code> for standalone crop legume BNF.
<code><a href="calc_weed_bnf.html">calc_weed_bnf</a></code> for standalone weed/cover crop BNF.
<code><a href="calc_nonsymbiotic_bnf.html">calc_nonsymbiotic_bnf</a></code> for standalone NSBNF.</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="fu"><a href="load_general_data.html">load_general_data</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Backward-compatible usage (no environmental data):</span></span></span>
<span class="r-in"><span><span class="va">bnf_results</span> <span class="op">&lt;-</span> <span class="va">npp_data</span> <span class="op">|&gt;</span> <span class="fu">calc_bnf</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># With full environmental characterisation:</span></span></span>
<span class="r-in"><span><span class="va">bnf_results</span> <span class="op">&lt;-</span> <span class="va">npp_data</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    N_synth_kgha <span class="op">=</span> <span class="fl">80</span>, N_org_kgha <span class="op">=</span> <span class="fl">20</span>,</span></span>
<span class="r-in"><span>    TMP <span class="op">=</span> <span class="fl">18</span>, precip_mm <span class="op">=</span> <span class="fl">650</span>, irrig_mm <span class="op">=</span> <span class="fl">100</span>,</span></span>
<span class="r-in"><span>    PET_mm <span class="op">=</span> <span class="fl">900</span>, SOM_pct <span class="op">=</span> <span class="fl">3.0</span>, soil_pH <span class="op">=</span> <span class="fl">6.5</span></span></span>
<span class="r-in"><span>  <span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu">calc_bnf</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://orcid.org/0000-0002-0429-0883" class="external-link">Eduardo Aguilera</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

