<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Calculate Complete Environmental Footprints Along Supply Chains — calculate_footprints • afsetools</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Calculate Complete Environmental Footprints Along Supply Chains — calculate_footprints"><meta name="description" content="Main workflow function that traces environmental footprints through global supply chains,
from primary production through processing, feed, and final products. This function
orchestrates the entire footprint calculation process and returns all intermediate
and final footprint data frames."><meta property="og:description" content="Main workflow function that traces environmental footprints through global supply chains,
from primary production through processing, feed, and final products. This function
orchestrates the entire footprint calculation process and returns all intermediate
and final footprint data frames."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">afsetools</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/eduaguilera/afsetools/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Calculate Complete Environmental Footprints Along Supply Chains</h1>
      <small class="dont-index">Source: <a href="https://github.com/eduaguilera/afsetools/blob/main/R/calculate_footprints.R" class="external-link"><code>R/calculate_footprints.R</code></a></small>
      <div class="d-none name"><code>calculate_footprints.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Main workflow function that traces environmental footprints through global supply chains,
from primary production through processing, feed, and final products. This function
orchestrates the entire footprint calculation process and returns all intermediate
and final footprint data frames.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">calculate_footprints</span><span class="op">(</span>dtm <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-dtm">dtm<a class="anchor" aria-label="anchor" href="#arg-dtm"></a></dt>
<dd><p>Optional detailed trade matrix. If `NULL` (default), the function
uses gross-trade mode (`calc_avail_fp_gt()`). If provided, it automatically
uses detailed bilateral trade mode (`calc_avail_fp_dtm()`). Required columns
when provided: `Year`, `area_code`, `area_code_p`, `area_p`,
`item_code_cbs`, `Element`, `Country_share` (with `Element == "Import"`
rows used). `Impact` is generated internally by expanding `dtm` rows across
impacts present in `Impact_prod` for each year.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A named list of intermediate and final footprint tables, including:
  `FP_prim`, `FP_prim_i`, `FP_prim_i_global`, `FP_prim_ds`, `FP_prim_ds_i`,
  `FP_processed_raw`, `FP_processed_raw_i`, `FP_processed_ds`,
  `FP_processed_ds_i`, `FP_reprocessed_raw`, `FP_reprocessed_raw_i`,
  `FP_raw_all`, `FP_feed_raw`, `FP_feed`, `FP_feed_i`, `FP_feed_ds`,
  `FP_feed_ds_i`, `FP_ioc`, `FP_i`, `FP_final`, `Seed_share`,
  `draught_shares`, `Import_share`, and `Processing_shares`.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>This function implements a complete footprint accounting system that:</p><ul><li><p>Calculates seed shares and removes them from production</p></li>
<li><p>Allocates impacts to co-products using economic allocation</p></li>
<li><p>Traces impacts through processing chains</p></li>
<li><p>Accounts for international trade (gross trade when `dtm` is `NULL`,
    bilateral trade matrix when `dtm` is provided)</p></li>
<li><p>Handles feed products and livestock production</p></li>
<li><p>Allocates draught animal services to crop production</p></li>
</ul><p>`calculate_footprints()` only takes `dtm` explicitly. All other required
inputs are read implicitly from objects in the calling environment.</p>
<p>Required workflow objects (created outside `load_general_data()`):</p><dl><dt>`CBS`</dt>
<dd><p>Commodity balance table. Columns used: `Year`, `area`,
  `area_code`, `item_cbs`, `item_code_cbs`, `Element`, `Value`.</p></dd>

  <dt>`Primary_all`</dt>
<dd><p>Primary production / co-product table. Columns used:
  `Year`, `area`, `area_code`, `item_prod`, `item_code_prod`, `unit`,
  `Value`, `item_cbs`, `item_code_cbs`, `Live_anim`, `Live_anim_code`.</p></dd>

  <dt>`Impact_prod`</dt>
<dd><p>Production impact table. Columns used: `Year`, `area`,
  `item_code_prod`, `Impact`, `Value`, `u_FU` (and optionally `item_prod`).</p></dd>

  <dt>`Crop_NPPr_NoFallow`</dt>
<dd><p>Crop NPP / residue table. Columns used:
  `Year`, `area`, `item_prod`, `item_cbs`, `Product_residue`,
  `Prod_ygpit_Mg`.</p></dd>

  <dt>`Feed_intake`</dt>
<dd><p>Feed intake table. Columns used: `Year`, `area`,
  `Live_anim`, `item_cbs`, `item_code_cbs`, `Supply`, `Intake_DM`.
  `area_code` is recovered from footprint tables during the feed join.</p></dd>

  <dt>`Primary_prices`</dt>
<dd><p>Primary product prices. Columns used: `Year`,
  `item_code_prod`, `Price`.</p></dd>

  <dt>`CBS_item_prices`</dt>
<dd><p>CBS item prices. Columns used: `Year`, `Element`,
  `item_cbs`, `item_code_cbs`, `Price`.</p></dd>

  <dt>`Processing_coefs`</dt>
<dd><p>Processing conversion coefficients. Columns used:
  `Year`, `area_code`, `item_code_cbs`, `item_cbs`, `cf`.</p></dd>

  <dt>`Relative_residue_price`</dt>
<dd><p>Numeric scalar used to value residues
  relative to product prices.</p></dd>


</dl><p>Required auxiliary objects loaded by `load_general_data()`:</p><dl><dt>`items_full` (sheet `items_full` in `Codes_coefs.xlsx`)</dt>
<dd><p>Columns used:
  `item_cbs`, `item_code_cbs`, `group`.</p></dd>

  <dt>`items_prod_full` (sheet `items_prod_full` in `Codes_coefs.xlsx`)</dt>
<dd><p>Columns used: `item_prod`, `item_code_prod`, `Name_biomass`.</p></dd>

  <dt>`Animals_codes` (sheet `Animals_codes` in `Codes_coefs.xlsx`)</dt>
<dd><p>Columns used: `item_cbs`, `item_code_cbs`.</p></dd>

  <dt>`Primary_double` (sheet `Primary_double` in `Codes_coefs.xlsx`)</dt>
<dd><p>Columns used (via `Prepare_prim()`): `Item_area`, `item_prod`,
  `item_code_prod`, `Multi_type`.</p></dd>

  <dt>`Biomass_coefs` (`Biomass_coefs.xlsx`)</dt>
<dd><p>Columns used:
  `Name_biomass`, `Product_kgDM_kgFM`, `Product_kgN_kgDM`.</p></dd>


</dl></div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://eduaguilera.github.io/afsetools">afsetools</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="load_general_data.html">load_general_data</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Requires workflow objects in the environment:</span></span></span>
<span class="r-in"><span><span class="co"># CBS, Primary_all, Impact_prod, Crop_NPPr_NoFallow, Feed_intake,</span></span></span>
<span class="r-in"><span><span class="co"># Primary_prices, CBS_item_prices, Processing_coefs, Relative_residue_price</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Calculate footprints using gross trade (omit dtm)</span></span></span>
<span class="r-in"><span><span class="va">footprints</span> <span class="op">&lt;-</span> <span class="fu">calculate_footprints</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># To use bilateral trade, pass dtm = my_dtm_data (or dtm = DTM)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Access individual footprint tables</span></span></span>
<span class="r-in"><span><span class="va">fp_primary</span> <span class="op">&lt;-</span> <span class="va">footprints</span><span class="op">$</span><span class="va">FP_prim</span></span></span>
<span class="r-in"><span><span class="va">fp_final</span> <span class="op">&lt;-</span> <span class="va">footprints</span><span class="op">$</span><span class="va">FP_final</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://orcid.org/0000-0002-0429-0883" class="external-link">Eduardo Aguilera</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

