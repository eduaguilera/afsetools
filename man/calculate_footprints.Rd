% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/calculate_footprints.R
\name{calculate_footprints}
\alias{calculate_footprints}
\title{Calculate Complete Environmental Footprints Along Supply Chains}
\usage{
calculate_footprints(dtm = NULL)
}
\arguments{
\item{dtm}{Optional detailed trade matrix. If `NULL` (default), the function
uses gross-trade mode (`calc_avail_fp_gt()`). If provided, it automatically
uses detailed bilateral trade mode (`calc_avail_fp_dtm()`). Required columns
when provided: `Year`, `area_code`, `area_code_p`, `area_p`,
`item_code_cbs`, `Element`, `Country_share` (with `Element == "Import"`
rows used). `Impact` is generated internally by expanding `dtm` rows across
impacts present in `Impact_prod` for each year.}
}
\value{
A named list of intermediate and final footprint tables, including:
  `FP_prim`, `FP_prim_i`, `FP_prim_i_global`, `FP_prim_ds`, `FP_prim_ds_i`,
  `FP_processed_raw`, `FP_processed_raw_i`, `FP_processed_ds`,
  `FP_processed_ds_i`, `FP_reprocessed_raw`, `FP_reprocessed_raw_i`,
  `FP_raw_all`, `FP_feed_raw`, `FP_feed`, `FP_feed_i`, `FP_feed_ds`,
  `FP_feed_ds_i`, `FP_ioc`, `FP_i`, `FP_final`, `Seed_share`,
  `draught_shares`, `Import_share`, and `Processing_shares`.
}
\description{
Main workflow function that traces environmental footprints through global supply chains,
from primary production through processing, feed, and final products. This function
orchestrates the entire footprint calculation process and returns all intermediate
and final footprint data frames.
}
\details{
This function implements a complete footprint accounting system that:
\itemize{
  \item Calculates seed shares and removes them from production
  \item Allocates impacts to co-products using economic allocation
  \item Traces impacts through processing chains
  \item Accounts for international trade (gross trade when `dtm` is `NULL`,
    bilateral trade matrix when `dtm` is provided)
  \item Handles feed products and livestock production
  \item Allocates draught animal services to crop production
}

\code{calculate_footprints()} only takes \code{dtm} explicitly. All other required
inputs are read implicitly from objects in the calling environment.

Required workflow objects (created outside \code{load_general_data()}):
\describe{
  \item{\code{CBS}}{Commodity balance table. Columns used: \code{Year},
  \code{area}, \code{area_code}, \code{item_cbs}, \code{item_code_cbs},
  \code{Element}, \code{Value}.}
  \item{\code{Primary_all}}{Primary production / co-product table. Columns used:
  \code{Year}, \code{area}, \code{area_code}, \code{item_prod},
  \code{item_code_prod}, \code{unit}, \code{Value}, \code{item_cbs},
  \code{item_code_cbs}, \code{Live_anim}, \code{Live_anim_code}.}
  \item{\code{Impact_prod}}{Production impact table. Columns used: \code{Year},
  \code{area}, \code{item_code_prod}, \code{Impact}, \code{Value},
  \code{u_FU} (and optionally \code{item_prod}).}
  \item{\code{Crop_NPPr_NoFallow}}{Crop NPP / residue table. Columns used:
  \code{Year}, \code{area}, \code{item_prod}, \code{item_cbs},
  \code{Product_residue}, \code{Prod_ygpit_Mg}.}
  \item{\code{Feed_intake}}{Feed intake table. Columns used: \code{Year},
  \code{area}, \code{Live_anim}, \code{item_cbs}, \code{item_code_cbs},
  \code{Supply}, \code{Intake_DM}. \code{area_code} is recovered from
  footprint tables during the feed join.}
  \item{\code{Primary_prices}}{Primary product prices. Columns used:
  \code{Year}, \code{item_code_prod}, \code{Price}.}
  \item{\code{CBS_item_prices}}{CBS item prices. Columns used: \code{Year},
  \code{Element}, \code{item_cbs}, \code{item_code_cbs}, \code{Price}.}
  \item{\code{Processing_coefs}}{Processing conversion coefficients. Columns
  used: \code{Year}, \code{area_code}, \code{item_code_cbs}, \code{item_cbs},
  \code{cf}.}
  \item{\code{Relative_residue_price}}{Numeric scalar used to value residues
  relative to product prices.}
}

Required auxiliary objects loaded by \code{load_general_data()}:
\describe{
  \item{\code{items_full} (sheet \code{items_full} in \code{Codes_coefs.xlsx})}{
  Columns used: \code{item_cbs}, \code{item_code_cbs}, \code{group}.}
  \item{\code{items_prod_full} (sheet \code{items_prod_full} in \code{Codes_coefs.xlsx})}{
  Columns used: \code{item_prod}, \code{item_code_prod}, \code{Name_biomass}.}
  \item{\code{Animals_codes} (sheet \code{Animals_codes} in \code{Codes_coefs.xlsx})}{
  Columns used: \code{item_cbs}, \code{item_code_cbs}.}
  \item{\code{Primary_double} (sheet \code{Primary_double} in \code{Codes_coefs.xlsx})}{
  Columns used (via \code{Prepare_prim()}): \code{Item_area},
  \code{item_prod}, \code{item_code_prod}, \code{Multi_type}.}
  \item{\code{Biomass_coefs} (\code{Biomass_coefs.xlsx})}{Columns used:
  \code{Name_biomass}, \code{Product_kgDM_kgFM}, \code{Product_kgN_kgDM}.}
}
}
\examples{
\dontrun{
library(afsetools)
load_general_data()

# Requires workflow objects in the environment:
# CBS, Primary_all, Impact_prod, Crop_NPPr_NoFallow, Feed_intake,
# Primary_prices, CBS_item_prices, Processing_coefs, Relative_residue_price

# Calculate footprints using gross trade (omit dtm)
footprints <- calculate_footprints()

# To use bilateral trade, pass dtm = my_dtm_data (or dtm = DTM)

# Access individual footprint tables
fp_primary <- footprints$FP_prim
fp_final <- footprints$FP_final
}
}
