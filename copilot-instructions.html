<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>GitHub Copilot Instructions for afsetools Package • afsetools</title><script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="GitHub Copilot Instructions for afsetools Package"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">afsetools</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.4</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/eduaguilera/afsetools/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-title-body">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>GitHub Copilot Instructions for afsetools Package</h1>
      <small class="dont-index">Source: <a href="https://github.com/eduaguilera/afsetools/blob/main/.github/copilot-instructions.md" class="external-link"><code>.github/copilot-instructions.md</code></a></small>
    </div>

<div id="github-copilot-instructions-for-afsetools-package" class="section level1">

<div class="section level2">
<h2 id="package-purpose">Package Purpose<a class="anchor" aria-label="anchor" href="#package-purpose"></a></h2>
<p><code>afsetools</code> (Agro-Food System and Environment Tools) is an R package providing core functions and data for calculating environmental footprints in agro-food systems. It contains standardized coefficients, classifications, and functions for tracing environmental impacts through global supply chains.</p>
</div>
<div class="section level2">
<h2 id="core-principles">Core Principles<a class="anchor" aria-label="anchor" href="#core-principles"></a></h2>
<ul><li>
<strong>Explicit package names</strong>: Always prefix functions (e.g., <code><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">dplyr::mutate()</a></code>, <code><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">tidyr::pivot_longer()</a></code>)</li>
<li>
<strong>Native pipe</strong>: Use <code>|&gt;</code> instead of <code>%&gt;%</code> (requires R &gt;= 4.1.0)</li>
<li>
<strong>Type-safe conditionals</strong>: Use <code><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">dplyr::if_else()</a></code> or <code><a href="https://dplyr.tidyverse.org/reference/case-and-replace-when.html" class="external-link">dplyr::case_when()</a></code> instead of base <code><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse()</a></code>
</li>
<li>
<strong>roxygen2 documentation</strong>: All exported functions must have complete roxygen2 documentation</li>
<li>
<strong>Package structure</strong>: Follow standard R package conventions (R/, man/, tests/, inst/extdata/)</li>
<li>
<strong>Keep data loading flexible</strong>: <code><a href="reference/load_general_data.html">load_general_data()</a></code> should work both as installed package and during development</li>
<li>
<strong>Documentation location</strong>: NEVER create documentation files in package root - use <code>additional_files/documentation/</code> structure</li>
</ul></div>
<div class="section level2">
<h2 id="architecture-data-driven-design">Architecture: Data-Driven Design<a class="anchor" aria-label="anchor" href="#architecture-data-driven-design"></a></h2>
<p><strong>CRITICAL</strong>: This package is fundamentally data-driven. The architecture flows from Excel coefficients → loaded objects → calculation functions:</p>
<ol style="list-style-type: decimal"><li>
<strong>Data files</strong> in <code>inst/extdata/</code>: Excel files contain 73+ coefficient tables and classifications</li>
<li>
<strong><code><a href="reference/load_general_data.html">load_general_data()</a></code></strong> in <code>R/load_data.R</code>: Loads all objects into user’s environment (NOT package namespace)</li>
<li>
<strong>Functions</strong> expect these objects to exist in calling environment (implicit dependencies)</li>
<li>
<strong>Workflow functions</strong> orchestrate complete calculations using multiple data objects</li>
</ol><p><strong>Key insight</strong>: Functions don’t pass data objects as parameters - they expect them in environment. Always call <code><a href="reference/load_general_data.html">load_general_data()</a></code> first.</p>
</div>
<div class="section level2">
<h2 id="environment-object-pattern">Environment Object Pattern<a class="anchor" aria-label="anchor" href="#environment-object-pattern"></a></h2>
<p>Unlike typical R packages, afsetools loads 73+ objects directly into the user’s environment:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://eduaguilera.github.io/afsetools">afsetools</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/load_general_data.html">load_general_data</a></span><span class="op">(</span><span class="op">)</span>  <span class="co"># Creates Biomass_coefs, GWP, BNF, etc. in environment</span></span>
<span><span class="va">npp</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/calculate_potential_npp.html">Calc_NPP_potentials</a></span><span class="op">(</span><span class="va">climate_data</span><span class="op">)</span>  <span class="co"># Functions use environment objects</span></span></code></pre></div>
<p><strong>Implications for development</strong>: - Functions have implicit dependencies on environment objects - Test files must call <code><a href="reference/load_general_data.html">load_general_data()</a></code> in setup (see <code>tests/testthat/setup-afsetools.R</code>) - Adding new data: Update <code><a href="reference/load_general_data.html">load_general_data()</a></code>, document in <code>R/data.R</code>, list in <code>DATA_REFERENCE.md</code></p>
</div>
<div class="section level2">
<h2 id="documentation-standards">Documentation Standards<a class="anchor" aria-label="anchor" href="#documentation-standards"></a></h2>
<div class="section level3">
<h3 id="function-documentation-roxygen2">Function Documentation (roxygen2)<a class="anchor" aria-label="anchor" href="#function-documentation-roxygen2"></a></h3>
<p>All exported functions MUST include these tags: - <code>@description</code> - Brief description of what the function does - <code>@param</code> (for each parameter) - Parameter name and description - <code>@return</code> - What the function returns - <code>@export</code> - Mark for export in NAMESPACE - <code>@examples</code> - Usage examples (wrap in <code>\dontrun{}</code> if requires external data)</p>
<p><strong>Format requirements</strong>: - One space after <code>#'</code> - Maximum line width: 80 characters - Multi-line descriptions indented two spaces - End all sentences with period - Use proper markdown formatting</p>
<p><strong>Example</strong>:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Calculate Net Primary Productivity</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' Calculates potential NPP using Miami, NCEAS, and Rosenzweig models from</span></span>
<span><span class="co">#' climate data.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @param Dataset Data frame containing climate variables: TMP (temperature),</span></span>
<span><span class="co">#'   MAP (precipitation), PET (potential evapotranspiration), AET (actual</span></span>
<span><span class="co">#'   evapotranspiration)</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @return Data frame with NPP estimates from three models (Miami, NCEAS,</span></span>
<span><span class="co">#'   Rosenzweig) in Mg C/ha/year</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @examples</span></span>
<span><span class="co">#' \dontrun{</span></span>
<span><span class="co">#' npp_results &lt;- Calc_NPP_potentials(climate_data)</span></span>
<span><span class="co">#' }</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="data-object-documentation">Data Object Documentation<a class="anchor" aria-label="anchor" href="#data-object-documentation"></a></h3>
<p>Data objects loaded by <code><a href="reference/load_general_data.html">load_general_data()</a></code> should be documented in <code>R/data.R</code>: - Use <code>@format</code> to describe structure with <code>\describe{}</code> - Include <code>@source</code> for data origin - Add <code>@docType data</code> and <code>@keywords datasets</code> - Keep descriptions concise but informative</p>
</div>
</div>
<div class="section level2">
<h2 id="code-style">Code Style<a class="anchor" aria-label="anchor" href="#code-style"></a></h2>
<div class="section level3">
<h3 id="naming-conventions">Naming Conventions<a class="anchor" aria-label="anchor" href="#naming-conventions"></a></h3>
<ul><li>
<strong>Functions</strong>: <code>snake_case</code> or <code>PascalCase</code> (be consistent within file)</li>
<li>
<strong>Variables/Columns</strong>: <code>snake_case</code> preferred</li>
<li>
<strong>Data objects</strong>: Match loaded object names (varies by source)</li>
<li>
<strong>File names</strong>: lowercase with underscores (e.g., <code>load_data.R</code>, <code>npp_functions.R</code>)</li>
</ul></div>
<div class="section level3">
<h3 id="style-guide">Style Guide<a class="anchor" aria-label="anchor" href="#style-guide"></a></h3>
<ul><li>Follow <a href="https://style.tidyverse.org/" class="external-link">Tidyverse style guide</a>
</li>
<li>Maximum line width: 80 characters</li>
<li>Use <code>.by</code> for inline grouping: <code>mutate(.by = Year, total = sum(value))</code>
</li>
<li>Avoid <code>group_by()</code> unless required by specific functions</li>
<li>
<strong>CRITICAL</strong>: Always <code>ungroup()</code> after <code>group_by()</code> operations</li>
</ul></div>
<div class="section level3">
<h3 id="grouping-pattern-important">Grouping Pattern (Important!)<a class="anchor" aria-label="anchor" href="#grouping-pattern-important"></a></h3>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># CORRECT: Use .by for simple operations</span></span>
<span><span class="va">df</span> <span class="op">|&gt;</span> <span class="fu">mutate</span><span class="op">(</span>.by <span class="op">=</span> <span class="va">Year</span>, total <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># For Filling() and FillingProxy(): Must use group_by/ungroup</span></span>
<span><span class="va">df</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">Region</span>, <span class="va">Item</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="reference/Filling.html">Filling</a></span><span class="op">(</span><span class="va">Production</span>, <span class="va">Year</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span>  <span class="co"># REQUIRED - prevents grouped data flowing downstream</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="package-data-management">Package Data Management<a class="anchor" aria-label="anchor" href="#package-data-management"></a></h2>
<div class="section level3">
<h3 id="loading-data-objects">Loading Data Objects<a class="anchor" aria-label="anchor" href="#loading-data-objects"></a></h3>
<ul><li>
<strong>Input files location</strong>: <code>inst/extdata/</code> (Excel files with coefficients)</li>
<li>
<strong>Loading function</strong>: <code><a href="reference/load_general_data.html">load_general_data()</a></code> creates 73+ objects in parent environment</li>
<li>
<strong>Access pattern</strong>: Users call <code><a href="reference/load_general_data.html">load_general_data()</a></code> after <code><a href="https://eduaguilera.github.io/afsetools">library(afsetools)</a></code>
</li>
<li>
<strong>No data in package namespace</strong>: Objects are loaded to user environment, not attached to package</li>
</ul></div>
<div class="section level3">
<h3 id="data-file-requirements">Data File Requirements<a class="anchor" aria-label="anchor" href="#data-file-requirements"></a></h3>
<ul><li>Store coefficient tables in Excel format in <code>inst/extdata/</code>
</li>
<li>Use consistent sheet names and column headers</li>
<li>Document all data sources and references</li>
<li>Include metadata sheets where appropriate</li>
</ul></div>
</div>
<div class="section level2">
<h2 id="function-organization">Function Organization<a class="anchor" aria-label="anchor" href="#function-organization"></a></h2>
<div class="section level3">
<h3 id="function-categories">Function Categories<a class="anchor" aria-label="anchor" href="#function-categories"></a></h3>
<ol style="list-style-type: decimal"><li>
<strong>Data Loading</strong> (<code>load_data.R</code>): <code><a href="reference/load_general_data.html">load_general_data()</a></code> - loads 73+ objects</li>
<li>
<strong>NPP Calculation</strong> (<code>npp_functions.R</code>): <code><a href="reference/calculate_potential_npp.html">Calc_NPP_potentials()</a></code>, <code><a href="reference/calculate_crop_npp.html">Calculate_crop_NPP()</a></code>, <code><a href="reference/calculate_npp_dm_c_n.html">Calc_NPP_DM_C_N()</a></code>, <code><a href="reference/calculate_crop_npp_components.html">Calc_CropNPP_components()</a></code>
</li>
<li>
<strong>Impact Tracing</strong> (<code>impact_functions.R</code>): <code><a href="reference/Prepare_prim.html">Prepare_prim()</a></code>, <code><a href="reference/Allocate_impacts_to_products.html">Allocate_impacts_to_products()</a></code>, <code><a href="reference/calc_avail_fp_gt.html">calc_avail_fp_gt()</a></code>, <code><a href="reference/Calc_impact_processed.html">Calc_impact_processed()</a></code>
</li>
<li>
<strong>Analysis</strong> (<code>analysis_functions.R</code>): <code><a href="reference/Calc_N_fix.html">Calc_N_fix()</a></code>, <code><a href="reference/Gases_GWP.html">Gases_GWP()</a></code>, <code><a href="reference/Calc_diets.html">Calc_diets()</a></code>, <code><a href="reference/calculate_land_scaling.html">calculate_land_scaling()</a></code>
</li>
<li>
<strong>Utilities</strong> (<code>utility_functions.R</code>): <code><a href="reference/Filling.html">Filling()</a></code>, <code><a href="reference/FillingProxy.html">FillingProxy()</a></code>, <code>%!in%</code>, <code><a href="reference/drop_cols.html">drop_cols()</a></code>
</li>
<li>
<strong>Visualization</strong> (<code>plotting.R</code>): <code><a href="reference/theme_new.html">theme_new()</a></code>, <code><a href="reference/theme_nolabel.html">theme_nolabel()</a></code>, <code><a href="reference/ggplotRegression.html">ggplotRegression()</a></code>
</li>
<li>
<strong>Workflows</strong> (<code>calculate_footprints.R</code>): Complete calculation pipelines</li>
</ol></div>
<div class="section level3">
<h3 id="function-design-patterns">Function Design Patterns<a class="anchor" aria-label="anchor" href="#function-design-patterns"></a></h3>
<p><strong>Pipe-friendly functions</strong> (return modified data frame):</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Calculate_crop_NPP</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">Dataset</span>, <span class="va">HI</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">Dataset</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">Biomass_coefs</span>, by <span class="op">=</span> <span class="st">"Name_biomass"</span><span class="op">)</span> <span class="op">|&gt;</span>  <span class="co"># Uses environment object</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Prod_MgDM <span class="op">=</span> <span class="va">Prod_ygpit_Mg</span> <span class="op">*</span> <span class="va">Product_kgDM_kgFM</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><strong>Environment object usage</strong> (implicit dependencies):</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Calc_N_fix</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">x</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">Names_BNF</span> <span class="op">|&gt;</span>  <span class="co"># Names_BNF from environment</span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">BNF</span>, by <span class="op">=</span> <span class="st">"Name_BNF"</span><span class="op">)</span>, by <span class="op">=</span> <span class="st">"Name_biomass"</span><span class="op">)</span> <span class="op">|&gt;</span>  <span class="co"># BNF from environment</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>CropBNF <span class="op">=</span> <span class="va">Crop_NPP_MgN</span> <span class="op">*</span> <span class="va">Ndfa</span> <span class="op">*</span> <span class="va">Leguminous_share</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="testing">Testing<a class="anchor" aria-label="anchor" href="#testing"></a></h2>
<p><strong>Location</strong>: <code>tests/testthat/</code> - name as <code>test-[script-name].R</code></p>
<p><strong>Critical setup pattern</strong>:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># tests/testthat/setup-afsetools.R</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://eduaguilera.github.io/afsetools">afsetools</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/load_general_data.html">load_general_data</a></span><span class="op">(</span><span class="op">)</span>  <span class="co"># Makes all 73+ objects available to tests</span></span></code></pre></div>
<p><strong>Testing approach</strong>: - One test file per R script (e.g., <code>test-load_data.R</code> for <code>load_data.R</code>) - Test that <code><a href="reference/load_general_data.html">load_general_data()</a></code> creates expected objects - Verify coefficient values are realistic (e.g., DM content 0-1) - Check data structure and required columns</p>
<p><strong>Useful test patterns</strong>:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Test environment loading</span></span>
<span><span class="fu">test_that</span><span class="op">(</span><span class="st">"load_general_data creates all required data objects"</span>, <span class="op">{</span></span>
<span>  <span class="va">test_env</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/environment.html" class="external-link">new.env</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">test_env</span>, <span class="fu"><a href="reference/load_general_data.html">load_general_data</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu">expect_true</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html" class="external-link">exists</a></span><span class="op">(</span><span class="st">"Biomass_coefs"</span>, envir <span class="op">=</span> <span class="va">test_env</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Test coefficient realism</span></span>
<span><span class="fu">expect_true</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="va">Biomass_coefs</span><span class="op">$</span><span class="va">Product_kgDM_kgFM</span> <span class="op">&gt;=</span> <span class="fl">0</span> <span class="op">&amp;</span> </span>
<span>               <span class="va">Biomass_coefs</span><span class="op">$</span><span class="va">Product_kgDM_kgFM</span> <span class="op">&lt;=</span> <span class="fl">1</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="dependencies">Dependencies<a class="anchor" aria-label="anchor" href="#dependencies"></a></h2>
<p><strong>Core tidyverse</strong>: dplyr, tidyr, ggplot2<br><strong>Data I/O</strong>: readxl, openxlsx<br><strong>Utilities</strong>: zoo (for <code><a href="reference/Filling.html">Filling()</a></code> functions)</p>
<p><strong>Dependency pattern</strong>: Always use explicit <code>package::function()</code> syntax in function code.</p>
</div>
<div class="section level2">
<h2 id="package-development-workflow">Package Development Workflow<a class="anchor" aria-label="anchor" href="#package-development-workflow"></a></h2>
<div class="section level3">
<h3 id="making-changes">Making Changes<a class="anchor" aria-label="anchor" href="#making-changes"></a></h3>
<ol style="list-style-type: decimal"><li>
<strong>Modify R functions</strong>: Update code in <code>R/</code> directory</li>
<li>
<strong>Update documentation</strong>: Modify roxygen2 comments</li>
<li>
<strong>Run document</strong>: <code>devtools::document()</code> to update man/ files</li>
<li>
<strong>Run tests</strong>: <code>devtools::test()</code> to verify nothing breaks</li>
<li>
<strong>Check package</strong>: <code>devtools::check()</code> for R CMD check</li>
<li>
<strong>Build site</strong>: GitHub Actions will rebuild pkgdown site automatically</li>
</ol></div>
<div class="section level3">
<h3 id="before-committing">Before Committing<a class="anchor" aria-label="anchor" href="#before-committing"></a></h3>
<ul><li>Run <code>devtools::check()</code> and fix all errors/warnings</li>
<li>Ensure all tests pass</li>
<li>Update NEWS.md if adding features or fixing bugs</li>
<li>Update DESCRIPTION (URL, BugReports) and _pkgdown.yml reference index</li>
<li>Document any new data objects in DATA_REFERENCE.md</li>
</ul></div>
<div class="section level3">
<h3 id="pkgdown-configuration">pkgdown Configuration<a class="anchor" aria-label="anchor" href="#pkgdown-configuration"></a></h3>
<p><strong>Two critical files must stay in sync</strong>: 1. <strong>DESCRIPTION</strong>: Must include <code>URL:</code> and <code>BugReports:</code> fields 2. **_pkgdown.yml**: All documented functions must be listed in <code>reference:</code> section</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="co"># _pkgdown.yml structure</span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a><span class="fu">reference</span><span class="kw">:</span></span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">title</span><span class="kw">:</span><span class="at"> Category Name</span></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a><span class="at">  </span><span class="fu">contents</span><span class="kw">:</span></span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> function_name</span><span class="co">  # Must match .Rd filename in man/</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="coefficient-management">Coefficient Management<a class="anchor" aria-label="anchor" href="#coefficient-management"></a></h2>
<p><strong>CRITICAL: Never hardcode coefficients</strong> - always load from data files or calculate from source data:</p>
<p><strong>Sources (in order of preference)</strong>: 1. <strong>Load from inst/extdata files</strong>: Biomass_coefs.xlsx, GWP.xlsx, BNF.xlsx, etc. 2. <strong>Calculate from source data</strong>: Document methodology in comments 3. <strong>Scientific literature</strong>: Always cite sources in comments</p>
<p><strong>Forbidden patterns</strong>: - ❌ Hardcoded numeric values without source - ❌ Made-up coefficients in code - ❌ Undocumented constants</p>
<p><strong>Correct patterns</strong>: - ✅ <code>left_join(Biomass_coefs, by = "Name_biomass")</code> - ✅ Load from Excel with documented source - ✅ Calculate with referenced methodology</p>
<p><strong>Example from code</strong>:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Weed coefficients derived from grass biomass coefficients</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/assign.html" class="external-link">assign</a></span><span class="op">(</span><span class="st">"Root_Shoot_ratio_W"</span>, </span>
<span>       <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">Biomass_coefs</span> <span class="op">|&gt;</span> </span>
<span>                    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Name_biomass</span> <span class="op">==</span> <span class="st">"Grass"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>                    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">Root_Shoot_ratio</span><span class="op">)</span><span class="op">)</span>,</span>
<span>       envir <span class="op">=</span> <span class="va">env</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="version-control">Version Control<a class="anchor" aria-label="anchor" href="#version-control"></a></h2>
<div class="section level3">
<h3 id="commit-messages">Commit Messages<a class="anchor" aria-label="anchor" href="#commit-messages"></a></h3>
<ul><li>Use clear, descriptive commit messages</li>
<li>Reference issues/PRs when applicable</li>
<li>Group related changes in single commit</li>
</ul></div>
<div class="section level3">
<h3 id="branch-strategy">Branch Strategy<a class="anchor" aria-label="anchor" href="#branch-strategy"></a></h3>
<ul><li>
<code>main</code> branch should always be stable</li>
<li>Create feature branches for development</li>
<li>Use pull requests for review</li>
</ul></div>
</div>
<div class="section level2">
<h2 id="documentation-website">Documentation Website<a class="anchor" aria-label="anchor" href="#documentation-website"></a></h2>
<ul><li>
<strong>Automatic deployment</strong>: GitHub Actions builds pkgdown site on push</li>
<li>
<strong>Site URL</strong>: <a href="https://eduaguilera.github.io/afsetools/" class="uri">https://eduaguilera.github.io/afsetools/</a>
</li>
<li>
<strong>Reference page</strong>: <a href="https://eduaguilera.github.io/afsetools/reference/index.html" class="uri">https://eduaguilera.github.io/afsetools/reference/index.html</a>
</li>
<li>**Update _pkgdown.yml**: Organize functions by category</li>
<li>
<strong>No manual building needed</strong>: Workflow handles everything</li>
</ul></div>
<div class="section level2">
<h2 id="additional-files-structure">Additional Files Structure<a class="anchor" aria-label="anchor" href="#additional-files-structure"></a></h2>
<p><strong>CRITICAL: Never create documentation or working files in the package root!</strong></p>
<p>Use the <code>additional_files/</code> folder for all non-package content. This folder is excluded from Git via <code>.gitignore</code>.</p>
<div class="section level3">
<h3 id="folder-organization">Folder Organization<a class="anchor" aria-label="anchor" href="#folder-organization"></a></h3>
<pre><code>additional_files/
├── documentation/
│   ├── fixes/           # Bug fixes and code changes documentation
│   ├── development/     # Development notes, design decisions
│   ├── analysis/        # Analysis documentation, research notes
│   └── meetings/        # Meeting notes, project discussions
├── data/
│   ├── raw/            # Raw data files (not in inst/extdata/)
│   ├── processed/      # Intermediate processed data
│   └── output/         # Analysis outputs, results
└── scripts/
    ├── development/    # Development/testing scripts
    ├── analysis/       # Analysis scripts
    └── utils/          # Utility scripts</code></pre>
</div>
<div class="section level3">
<h3 id="documentation-guidelines">Documentation Guidelines<a class="anchor" aria-label="anchor" href="#documentation-guidelines"></a></h3>
<p><strong>Where to document:</strong> - ❌ <strong>NEVER in root</strong>: No markdown files except README.md, NEWS.md, CITATION, LICENSE - ✅ <strong>Code changes</strong>: <code>additional_files/documentation/fixes/</code> - ✅ <strong>Development notes</strong>: <code>additional_files/documentation/development/</code> - ✅ <strong>Analysis results</strong>: <code>additional_files/documentation/analysis/</code> - ✅ <strong>Function docs</strong>: <code>R/</code> files using roxygen2 comments - ✅ <strong>Package docs</strong>: <code>man/</code> (auto-generated from roxygen2)</p>
<p><strong>What goes where:</strong> - <strong>Bug fixes and patches</strong> → <code>additional_files/documentation/fixes/</code> - <strong>Feature development notes</strong> → <code>additional_files/documentation/development/</code> - <strong>Test results and debugging</strong> → <code>additional_files/documentation/fixes/</code> - <strong>Research and analysis</strong> → <code>additional_files/documentation/analysis/</code> - <strong>Temporary scripts</strong> → <code>additional_files/scripts/development/</code></p>
<p><strong>Naming conventions:</strong> - Use descriptive names: <code>fix_bnf_calculation_2025-11-06.md</code> - Include dates for time-sensitive docs: <code>YYYY-MM-DD</code> format - Use lowercase with hyphens: <code>migration-summary.md</code> - Group related files in subdirectories</p>
</div>
</div>
<div class="section level2">
<h2 id="common-tasks">Common Tasks<a class="anchor" aria-label="anchor" href="#common-tasks"></a></h2>
<div class="section level3">
<h3 id="adding-a-new-function">Adding a New Function<a class="anchor" aria-label="anchor" href="#adding-a-new-function"></a></h3>
<ol style="list-style-type: decimal"><li>Write function in appropriate R/ file (see function categories above)</li>
<li>Add complete roxygen2 documentation</li>
<li>Export if needed (<code>@export</code>)</li>
<li>**Add to _pkgdown.yml reference index** under appropriate category</li>
<li>Write tests in tests/testthat/</li>
<li>Run <code>devtools::document()</code> and <code>devtools::check()</code>
</li>
<li>Document development process in <code>additional_files/documentation/development/</code> if complex</li>
</ol></div>
<div class="section level3">
<h3 id="adding-new-data-objects">Adding New Data Objects<a class="anchor" aria-label="anchor" href="#adding-new-data-objects"></a></h3>
<ol style="list-style-type: decimal"><li>Add data file to <code>inst/extdata/</code> (Excel format preferred)</li>
<li>Update <code><a href="reference/load_general_data.html">load_general_data()</a></code> to load the new data</li>
<li>Document in <code>R/data.R</code> with roxygen2</li>
<li>Add description to <code>DATA_REFERENCE.md</code>
</li>
<li>**List in _pkgdown.yml under “Data Objects”**</li>
</ol></div>
<div class="section level3">
<h3 id="updating-coefficients">Updating Coefficients<a class="anchor" aria-label="anchor" href="#updating-coefficients"></a></h3>
<ol style="list-style-type: decimal"><li>Update source file in inst/extdata/</li>
<li>Document changes in comments</li>
<li>Verify downstream functions still work</li>
<li>Update tests if coefficient values changed</li>
<li>Note changes in NEWS.md</li>
</ol></div>
</div>
<div class="section level2">
<h2 id="resources">Resources<a class="anchor" aria-label="anchor" href="#resources"></a></h2>
<ul><li>
<strong>Package website</strong>: <a href="https://eduaguilera.github.io/afsetools/" class="uri">https://eduaguilera.github.io/afsetools/</a>
</li>
<li>
<strong>Tidyverse style guide</strong>: <a href="https://style.tidyverse.org/" class="external-link uri">https://style.tidyverse.org/</a>
</li>
<li>
<strong>R Packages book</strong>: <a href="https://r-pkgs.org/" class="external-link uri">https://r-pkgs.org/</a>
</li>
<li>
<strong>roxygen2 documentation</strong>: <a href="https://roxygen2.r-lib.org/" class="external-link uri">https://roxygen2.r-lib.org/</a>
</li>
<li>
<strong>pkgdown</strong>: <a href="https://pkgdown.r-lib.org/" class="external-link uri">https://pkgdown.r-lib.org/</a>
</li>
</ul></div>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://orcid.org/0000-0002-0429-0883" class="external-link">Eduardo Aguilera</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

