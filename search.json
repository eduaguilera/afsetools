[{"path":"https://eduaguilera.github.io/afsetools/DATA_REFERENCE.html","id":null,"dir":"","previous_headings":"","what":"afsetools Data Reference","title":"afsetools Data Reference","text":"document describes 73+ data objects loaded load_general_data(). objects automatically loaded R environment call function.","code":""},{"path":"https://eduaguilera.github.io/afsetools/DATA_REFERENCE.html","id":"quick-reference","dir":"","previous_headings":"","what":"Quick Reference","title":"afsetools Data Reference","text":"","code":"library(afsetools) load_general_data()  # Loads all 73+ objects below"},{"path":[]},{"path":"https://eduaguilera.github.io/afsetools/DATA_REFERENCE.html","id":"core-classifications","dir":"","previous_headings":"Nomenclatures and Classifications (35 objects)","what":"Core Classifications","title":"afsetools Data Reference","text":"items_full - Complete item nomenclature codes, names, categories items_prod_full - Production-specific item classifications items_cbs - Commodity Balance Sheet item codes regions_full - Country codes names regional aggregations regions_full_uISO3 - Regional classifications ISO3 codes","code":""},{"path":"https://eduaguilera.github.io/afsetools/DATA_REFERENCE.html","id":"product-categories","dir":"","previous_headings":"Nomenclatures and Classifications (35 objects)","what":"Product Categories","title":"afsetools Data Reference","text":"Cats - Primary product categories groupings Cats_proc - Processed product categories Primary_double - Items multiple primary products (co-products) Secondary_double - Items multiple secondary products","code":""},{"path":"https://eduaguilera.github.io/afsetools/DATA_REFERENCE.html","id":"processing-and-trade","dir":"","previous_headings":"Nomenclatures and Classifications (35 objects)","what":"Processing and Trade","title":"afsetools Data Reference","text":"Extraction_rates - Processing extraction rates product Processing_shares - Allocation shares processing chains Trade_codes - Trade classification codes mappings Supply_util - Supply utilization categories","code":""},{"path":"https://eduaguilera.github.io/afsetools/DATA_REFERENCE.html","id":"additional-classifications-25-more-objects","dir":"","previous_headings":"Nomenclatures and Classifications (35 objects)","what":"Additional Classifications (25+ more objects)","title":"afsetools Data Reference","text":"Including specialized nomenclatures crops, livestock, feed, regional aggregations.","code":""},{"path":[]},{"path":"https://eduaguilera.github.io/afsetools/DATA_REFERENCE.html","id":"main-coefficients","dir":"","previous_headings":"Biomass Coefficients (17 objects)","what":"Main Coefficients","title":"afsetools Data Reference","text":"Dry matter content (DM) Nitrogen content (N) Carbon content (C) Energy content (energy_MJ_kg) Digestible energy livestock Metabolizable energy values","code":""},{"path":"https://eduaguilera.github.io/afsetools/DATA_REFERENCE.html","id":"root-and-residue-parameters","dir":"","previous_headings":"Biomass Coefficients (17 objects)","what":"Root and Residue Parameters","title":"afsetools Data Reference","text":"Root_ref - Reference root biomass values crop type Residue_Shares - Management shares crop residues (harvested vs. left field) Root_Shoot_ratios - Root shoot biomass ratios Harvest_indices - Harvest index values different crops","code":""},{"path":"https://eduaguilera.github.io/afsetools/DATA_REFERENCE.html","id":"scaling-and-conversion-factors","dir":"","previous_headings":"Biomass Coefficients (17 objects)","what":"Scaling and Conversion Factors","title":"afsetools Data Reference","text":"Weed_NPP_Scaling - Scaling factors weed biomass relative crops Fallow_cover - Vegetation cover fractions fallow land Land_scaling - Land use intensity scaling factors Protein_digestibility - Protein digestibility coefficients","code":""},{"path":"https://eduaguilera.github.io/afsetools/DATA_REFERENCE.html","id":"additional-coefficients-12-more-objects","dir":"","previous_headings":"Biomass Coefficients (17 objects)","what":"Additional Coefficients (12+ more objects)","title":"afsetools Data Reference","text":"Including specialized conversion factors different biomass types management systems.","code":""},{"path":"https://eduaguilera.github.io/afsetools/DATA_REFERENCE.html","id":"global-warming-potentials-7-objects","dir":"","previous_headings":"","what":"Global Warming Potentials (7 objects)","title":"afsetools Data Reference","text":"GWP - Complete GWP table multiple time horizons GWP_100 - 100-year GWP values (commonly used) GWP_20 - 20-year GWP values GWP_500 - 500-year GWP values Gas_categories - GHG gas type classifications IPCC_factors - IPCC emission factors CH4_fossil_biogenic - Separate factors fossil vs biogenic methane","code":""},{"path":"https://eduaguilera.github.io/afsetools/DATA_REFERENCE.html","id":"biological-nitrogen-fixation-3-objects","dir":"","previous_headings":"","what":"Biological Nitrogen Fixation (3 objects)","title":"afsetools Data Reference","text":"Ndfa (% N derived atmosphere) Leguminous_share (fraction legumes) BGN (-ground nitrogen) NHI (nitrogen harvest index) Names_BNF - BNF nomenclature crop mappings Ndfa_ref - Reference Ndfa values crop region","code":""},{"path":[]},{"path":"https://eduaguilera.github.io/afsetools/DATA_REFERENCE.html","id":"weed-biomass-constants","dir":"","previous_headings":"Constants and Scalars (6 objects)","what":"Weed Biomass Constants","title":"afsetools Data Reference","text":"Residue_kgC_kgDM_W - Carbon content weed residues (kg C / kg DM) Root_kgC_kgDM_W - Carbon content weed roots (kg C / kg DM) Residue_kgN_kgDM_W - Nitrogen content weed residues (kg N / kg DM) Root_kgN_kgDM_W - Nitrogen content weed roots (kg N / kg DM) Root_Shoot_ratio_W - Root shoot ratio weeds Rhizod_kgN_kgRootN_W - Rhizodeposition nitrogen coefficient weeds","code":""},{"path":[]},{"path":"https://eduaguilera.github.io/afsetools/DATA_REFERENCE.html","id":"impact-specific-colors","dir":"","previous_headings":"Color Palettes and Vectors (8+ objects)","what":"Impact-Specific Colors","title":"afsetools Data Reference","text":"Total_color - Color total/overall impact categories SOM_color - Soil organic matter impact colors GHG_color - Greenhouse gas impact colors N_color - Nitrogen-related impact colors P_color - Phosphorus-related impact colors Land_color - Land use impact colors Water_color - Water use impact colors Energy_color - Energy use impact colors","code":""},{"path":"https://eduaguilera.github.io/afsetools/DATA_REFERENCE.html","id":"utility-vectors","dir":"","previous_headings":"Color Palettes and Vectors (8+ objects)","what":"Utility Vectors","title":"afsetools Data Reference","text":"Month_names - Month name vectors plotting Month_numbers - Month number sequences","code":""},{"path":"https://eduaguilera.github.io/afsetools/DATA_REFERENCE.html","id":"data-sources","dir":"","previous_headings":"","what":"Data Sources","title":"afsetools Data Reference","text":"coefficients classifications derived harmonized datasets including: FAO Statistics - Production, trade, commodity balance data IPCC Guidelines - Emission factors GWP values Scientific Literature - Biomass coefficients BNF parameters LUH2 Dataset - Land use harmonization data Nutrient Databases - Food composition nutritional data","code":""},{"path":"https://eduaguilera.github.io/afsetools/DATA_REFERENCE.html","id":"usage-examples","dir":"","previous_headings":"","what":"Usage Examples","title":"afsetools Data Reference","text":"","code":"# Load all data load_general_data()  # Explore nomenclatures head(items_full) head(regions_full)  # Check available coefficients head(Biomass_coefs) head(GWP)  # Use in calculations my_data %>%   left_join(Biomass_coefs, by = \"item\") %>%   left_join(GWP, by = \"gas_type\")  # Access constants carbon_content <- Residue_kgC_kgDM_W colors_for_plot <- GHG_color"},{"path":"https://eduaguilera.github.io/afsetools/DATA_REFERENCE.html","id":"object-relationships","dir":"","previous_headings":"","what":"Object Relationships","title":"afsetools Data Reference","text":"Many objects designed work together: Items nomenclatures link production data coefficients Biomass_coefs provides conversion factors NPP functions GWP values work emission calculation functions BNF parameters integrate nitrogen cycling functions Color palettes match impact categories results function documentation, use R’s help system: ?function_name help(package = \"afsetools\").","code":""},{"path":"https://eduaguilera.github.io/afsetools/authors.html","id":null,"dir":"","previous_headings":"","what":"Authors","title":"Authors and Citation","text":"Eduardo Aguilera. Author, maintainer.","code":""},{"path":"https://eduaguilera.github.io/afsetools/authors.html","id":"citation","dir":"","previous_headings":"","what":"Citation","title":"Authors and Citation","text":"Aguilera E (2026). afsetools: Agro-Food System Environment Tools. R package version 0.2.0, https://eduaguilera.github.io/afsetools.","code":"@Manual{,   title = {afsetools: Agro-Food System and Environment Tools},   author = {Eduardo Aguilera},   year = {2026},   note = {R package version 0.2.0},   url = {https://eduaguilera.github.io/afsetools}, }"},{"path":[]},{"path":"https://eduaguilera.github.io/afsetools/copilot-instructions.html","id":"package-purpose","dir":"","previous_headings":"","what":"Package Purpose","title":"GitHub Copilot Instructions for afsetools Package","text":"afsetools (Agro-Food System Environment Tools) R package providing core functions data calculating environmental footprints agro-food systems. contains standardized coefficients, classifications, functions tracing environmental impacts global supply chains.","code":""},{"path":"https://eduaguilera.github.io/afsetools/copilot-instructions.html","id":"core-principles","dir":"","previous_headings":"","what":"Core Principles","title":"GitHub Copilot Instructions for afsetools Package","text":"Explicit package names: Always prefix functions (e.g., dplyr::mutate(), tidyr::pivot_longer()) Native pipe: Use |> instead %>% (requires R >= 4.1.0) Type-safe conditionals: Use dplyr::if_else() dplyr::case_when() instead base ifelse() roxygen2 documentation: exported functions must complete roxygen2 documentation Package structure: Follow standard R package conventions (R/, man/, tests/, inst/extdata/) Keep data loading flexible: load_general_data() work installed package development Documentation location: NEVER create documentation files package root - use additional_files/documentation/ structure","code":""},{"path":"https://eduaguilera.github.io/afsetools/copilot-instructions.html","id":"architecture-data-driven-design","dir":"","previous_headings":"","what":"Architecture: Data-Driven Design","title":"GitHub Copilot Instructions for afsetools Package","text":"CRITICAL: package fundamentally data-driven. architecture flows Excel coefficients → loaded objects → calculation functions: Data files inst/extdata/: Excel files contain 73+ coefficient tables classifications load_general_data() R/load_data.R: Loads objects user’s environment (package namespace) Functions expect objects exist calling environment (implicit dependencies) Workflow functions orchestrate complete calculations using multiple data objects Key insight: Functions don’t pass data objects parameters - expect environment. Always call load_general_data() first.","code":""},{"path":"https://eduaguilera.github.io/afsetools/copilot-instructions.html","id":"environment-object-pattern","dir":"","previous_headings":"","what":"Environment Object Pattern","title":"GitHub Copilot Instructions for afsetools Package","text":"Unlike typical R packages, afsetools loads 73+ objects directly user’s environment: Implications development: - Functions implicit dependencies environment objects - Test files must call load_general_data() setup (see tests/testthat/setup-afsetools.R) - Adding new data: Update load_general_data(), document R/data.R, list DATA_REFERENCE.md","code":"library(afsetools) load_general_data()  # Creates Biomass_coefs, GWP, BNF, etc. in environment npp <- Calc_NPP_potentials(climate_data)  # Functions use environment objects"},{"path":[]},{"path":"https://eduaguilera.github.io/afsetools/copilot-instructions.html","id":"function-documentation-roxygen2","dir":"","previous_headings":"Documentation Standards","what":"Function Documentation (roxygen2)","title":"GitHub Copilot Instructions for afsetools Package","text":"exported functions MUST include tags: - @description - Brief description function - @param (parameter) - Parameter name description - @return - function returns - @export - Mark export NAMESPACE - @examples - Usage examples (wrap \\dontrun{} requires external data) Format requirements: - One space #' - Maximum line width: 80 characters - Multi-line descriptions indented two spaces - End sentences period - Use proper markdown formatting Example:","code":"#' Calculate Net Primary Productivity #' #' Calculates potential NPP using Miami, NCEAS, and Rosenzweig models from #' climate data. #' #' @param Dataset Data frame containing climate variables: TMP (temperature), #'   MAP (precipitation), PET (potential evapotranspiration), AET (actual #'   evapotranspiration) #' #' @return Data frame with NPP estimates from three models (Miami, NCEAS, #'   Rosenzweig) in Mg C/ha/year #' @export #' #' @examples #' \\dontrun{ #' npp_results <- Calc_NPP_potentials(climate_data) #' }"},{"path":"https://eduaguilera.github.io/afsetools/copilot-instructions.html","id":"data-object-documentation","dir":"","previous_headings":"Documentation Standards","what":"Data Object Documentation","title":"GitHub Copilot Instructions for afsetools Package","text":"Data objects loaded load_general_data() documented R/data.R: - Use @format describe structure \\describe{} - Include @source data origin - Add @docType data @keywords datasets - Keep descriptions concise informative","code":""},{"path":[]},{"path":"https://eduaguilera.github.io/afsetools/copilot-instructions.html","id":"naming-conventions","dir":"","previous_headings":"Code Style","what":"Naming Conventions","title":"GitHub Copilot Instructions for afsetools Package","text":"Functions: snake_case PascalCase (consistent within file) Variables/Columns: snake_case preferred Data objects: Match loaded object names (varies source) File names: lowercase underscores (e.g., load_data.R, npp_functions.R)","code":""},{"path":"https://eduaguilera.github.io/afsetools/copilot-instructions.html","id":"style-guide","dir":"","previous_headings":"Code Style","what":"Style Guide","title":"GitHub Copilot Instructions for afsetools Package","text":"Follow Tidyverse style guide Maximum line width: 80 characters Use .inline grouping: mutate(.= Year, total = sum(value)) Avoid group_by() unless required specific functions CRITICAL: Always ungroup() group_by() operations","code":""},{"path":"https://eduaguilera.github.io/afsetools/copilot-instructions.html","id":"grouping-pattern-important","dir":"","previous_headings":"Code Style","what":"Grouping Pattern (Important!)","title":"GitHub Copilot Instructions for afsetools Package","text":"","code":"# CORRECT: Use .by for simple operations df |> mutate(.by = Year, total = sum(value))  # For Filling() and FillingProxy(): Must use group_by/ungroup df |>   group_by(Region, Item) |>   Filling(Production, Year) |>   ungroup()  # REQUIRED - prevents grouped data flowing downstream"},{"path":[]},{"path":"https://eduaguilera.github.io/afsetools/copilot-instructions.html","id":"loading-data-objects","dir":"","previous_headings":"Package Data Management","what":"Loading Data Objects","title":"GitHub Copilot Instructions for afsetools Package","text":"Input files location: inst/extdata/ (Excel files coefficients) Loading function: load_general_data() creates 73+ objects parent environment Access pattern: Users call load_general_data() library(afsetools) data package namespace: Objects loaded user environment, attached package","code":""},{"path":"https://eduaguilera.github.io/afsetools/copilot-instructions.html","id":"data-file-requirements","dir":"","previous_headings":"Package Data Management","what":"Data File Requirements","title":"GitHub Copilot Instructions for afsetools Package","text":"Store coefficient tables Excel format inst/extdata/ Use consistent sheet names column headers Document data sources references Include metadata sheets appropriate","code":""},{"path":[]},{"path":"https://eduaguilera.github.io/afsetools/copilot-instructions.html","id":"function-categories","dir":"","previous_headings":"Function Organization","what":"Function Categories","title":"GitHub Copilot Instructions for afsetools Package","text":"Data Loading (load_data.R): load_general_data() - loads 73+ objects NPP Calculation (npp_functions.R): Calc_NPP_potentials(), Calculate_crop_NPP(), Calc_NPP_DM_C_N(), Calc_CropNPP_components() Impact Tracing (impact_functions.R): Prepare_prim(), Allocate_impacts_to_products(), calc_avail_fp_gt(), Calc_impact_processed() Analysis (analysis_functions.R): Calc_N_fix(), Gases_GWP(), Calc_diets(), calculate_land_scaling() Utilities (utility_functions.R): Filling(), FillingProxy(), %!%, drop_cols() Visualization (plotting.R): theme_new(), theme_nolabel(), ggplotRegression() Workflows (calculate_footprints.R): Complete calculation pipelines","code":""},{"path":"https://eduaguilera.github.io/afsetools/copilot-instructions.html","id":"function-design-patterns","dir":"","previous_headings":"Function Organization","what":"Function Design Patterns","title":"GitHub Copilot Instructions for afsetools Package","text":"Pipe-friendly functions (return modified data frame): Environment object usage (implicit dependencies):","code":"Calculate_crop_NPP <- function(Dataset, HI, ...) {   Dataset |>     dplyr::left_join(Biomass_coefs, by = \"Name_biomass\") |>  # Uses environment object     dplyr::mutate(Prod_MgDM = Prod_ygpit_Mg * Product_kgDM_kgFM) |>     dplyr::select(...) } Calc_N_fix <- function(x) {   x |>     dplyr::left_join(Names_BNF |>  # Names_BNF from environment       dplyr::left_join(BNF, by = \"Name_BNF\"), by = \"Name_biomass\") |>  # BNF from environment     dplyr::mutate(CropBNF = Crop_NPP_MgN * Ndfa * Leguminous_share) }"},{"path":"https://eduaguilera.github.io/afsetools/copilot-instructions.html","id":"testing","dir":"","previous_headings":"","what":"Testing","title":"GitHub Copilot Instructions for afsetools Package","text":"Location: tests/testthat/ - name test-[script-name].R Critical setup pattern: Testing approach: - One test file per R script (e.g., test-load_data.R load_data.R) - Test load_general_data() creates expected objects - Verify coefficient values realistic (e.g., DM content 0-1) - Check data structure required columns Useful test patterns:","code":"# tests/testthat/setup-afsetools.R library(afsetools) load_general_data()  # Makes all 73+ objects available to tests # Test environment loading test_that(\"load_general_data creates all required data objects\", {   test_env <- new.env()   with(test_env, load_general_data())   expect_true(exists(\"Biomass_coefs\", envir = test_env)) })  # Test coefficient realism expect_true(all(Biomass_coefs$Product_kgDM_kgFM >= 0 &                 Biomass_coefs$Product_kgDM_kgFM <= 1, na.rm = TRUE))"},{"path":"https://eduaguilera.github.io/afsetools/copilot-instructions.html","id":"dependencies","dir":"","previous_headings":"","what":"Dependencies","title":"GitHub Copilot Instructions for afsetools Package","text":"Core tidyverse: dplyr, tidyr, ggplot2Data /O: readxl, openxlsxUtilities: zoo (Filling() functions) Dependency pattern: Always use explicit package::function() syntax function code.","code":""},{"path":[]},{"path":"https://eduaguilera.github.io/afsetools/copilot-instructions.html","id":"making-changes","dir":"","previous_headings":"Package Development Workflow","what":"Making Changes","title":"GitHub Copilot Instructions for afsetools Package","text":"Modify R functions: Update code R/ directory Update documentation: Modify roxygen2 comments Run document: devtools::document() update man/ files Run tests: devtools::test() verify nothing breaks Check package: devtools::check() R CMD check Build site: GitHub Actions rebuild pkgdown site automatically","code":""},{"path":"https://eduaguilera.github.io/afsetools/copilot-instructions.html","id":"before-committing","dir":"","previous_headings":"Package Development Workflow","what":"Before Committing","title":"GitHub Copilot Instructions for afsetools Package","text":"Run devtools::check() fix errors/warnings Ensure tests pass Update NEWS.md adding features fixing bugs Update DESCRIPTION (URL, BugReports) _pkgdown.yml reference index Document new data objects DATA_REFERENCE.md","code":""},{"path":"https://eduaguilera.github.io/afsetools/copilot-instructions.html","id":"pkgdown-configuration","dir":"","previous_headings":"Package Development Workflow","what":"pkgdown Configuration","title":"GitHub Copilot Instructions for afsetools Package","text":"Two critical files must stay sync: 1. DESCRIPTION: Must include URL: BugReports: fields 2. **_pkgdown.yml**: documented functions must listed reference: section","code":"# _pkgdown.yml structure reference: - title: Category Name   contents:   - function_name  # Must match .Rd filename in man/"},{"path":"https://eduaguilera.github.io/afsetools/copilot-instructions.html","id":"coefficient-management","dir":"","previous_headings":"","what":"Coefficient Management","title":"GitHub Copilot Instructions for afsetools Package","text":"CRITICAL: Never hardcode coefficients - always load data files calculate source data: Sources (order preference): 1. Load inst/extdata files: Biomass_coefs.xlsx, GWP.xlsx, BNF.xlsx, etc. 2. Calculate source data: Document methodology comments 3. Scientific literature: Always cite sources comments Forbidden patterns: - ❌ Hardcoded numeric values without source - ❌ Made-coefficients code - ❌ Undocumented constants Correct patterns: - ✅ left_join(Biomass_coefs, = \"Name_biomass\") - ✅ Load Excel documented source - ✅ Calculate referenced methodology Example code:","code":"# Weed coefficients derived from grass biomass coefficients assign(\"Root_Shoot_ratio_W\",         as.numeric(Biomass_coefs |>                      dplyr::filter(Name_biomass == \"Grass\") |>                      dplyr::select(Root_Shoot_ratio)),        envir = env)"},{"path":[]},{"path":"https://eduaguilera.github.io/afsetools/copilot-instructions.html","id":"commit-messages","dir":"","previous_headings":"Version Control","what":"Commit Messages","title":"GitHub Copilot Instructions for afsetools Package","text":"Use clear, descriptive commit messages Reference issues/PRs applicable Group related changes single commit","code":""},{"path":"https://eduaguilera.github.io/afsetools/copilot-instructions.html","id":"branch-strategy","dir":"","previous_headings":"Version Control","what":"Branch Strategy","title":"GitHub Copilot Instructions for afsetools Package","text":"main branch always stable Create feature branches development Use pull requests review","code":""},{"path":"https://eduaguilera.github.io/afsetools/copilot-instructions.html","id":"documentation-website","dir":"","previous_headings":"","what":"Documentation Website","title":"GitHub Copilot Instructions for afsetools Package","text":"Automatic deployment: GitHub Actions builds pkgdown site push Site URL: https://eduaguilera.github.io/afsetools/ Reference page: https://eduaguilera.github.io/afsetools/reference/index.html **Update _pkgdown.yml**: Organize functions category manual building needed: Workflow handles everything","code":""},{"path":"https://eduaguilera.github.io/afsetools/copilot-instructions.html","id":"additional-files-structure","dir":"","previous_headings":"","what":"Additional Files Structure","title":"GitHub Copilot Instructions for afsetools Package","text":"CRITICAL: Never create documentation working files package root! Use additional_files/ folder non-package content. folder excluded Git via .gitignore.","code":""},{"path":"https://eduaguilera.github.io/afsetools/copilot-instructions.html","id":"folder-organization","dir":"","previous_headings":"Additional Files Structure","what":"Folder Organization","title":"GitHub Copilot Instructions for afsetools Package","text":"","code":"additional_files/ ├── documentation/ │   ├── fixes/           # Bug fixes and code changes documentation │   ├── development/     # Development notes, design decisions │   ├── analysis/        # Analysis documentation, research notes │   └── meetings/        # Meeting notes, project discussions ├── data/ │   ├── raw/            # Raw data files (not in inst/extdata/) │   ├── processed/      # Intermediate processed data │   └── output/         # Analysis outputs, results └── scripts/     ├── development/    # Development/testing scripts     ├── analysis/       # Analysis scripts     └── utils/          # Utility scripts"},{"path":"https://eduaguilera.github.io/afsetools/copilot-instructions.html","id":"documentation-guidelines","dir":"","previous_headings":"Additional Files Structure","what":"Documentation Guidelines","title":"GitHub Copilot Instructions for afsetools Package","text":"document: - ❌ NEVER root: markdown files except README.md, NEWS.md, CITATION, LICENSE - ✅ Code changes: additional_files/documentation/fixes/ - ✅ Development notes: additional_files/documentation/development/ - ✅ Analysis results: additional_files/documentation/analysis/ - ✅ Function docs: R/ files using roxygen2 comments - ✅ Package docs: man/ (auto-generated roxygen2) goes : - Bug fixes patches → additional_files/documentation/fixes/ - Feature development notes → additional_files/documentation/development/ - Test results debugging → additional_files/documentation/fixes/ - Research analysis → additional_files/documentation/analysis/ - Temporary scripts → additional_files/scripts/development/ Naming conventions: - Use descriptive names: fix_bnf_calculation_2025-11-06.md - Include dates time-sensitive docs: YYYY-MM-DD format - Use lowercase hyphens: migration-summary.md - Group related files subdirectories","code":""},{"path":[]},{"path":"https://eduaguilera.github.io/afsetools/copilot-instructions.html","id":"adding-a-new-function","dir":"","previous_headings":"Common Tasks","what":"Adding a New Function","title":"GitHub Copilot Instructions for afsetools Package","text":"Write function appropriate R/ file (see function categories ) Add complete roxygen2 documentation Export needed (@export) **Add _pkgdown.yml reference index** appropriate category Write tests tests/testthat/ Run devtools::document() devtools::check() Document development process additional_files/documentation/development/ complex","code":""},{"path":"https://eduaguilera.github.io/afsetools/copilot-instructions.html","id":"adding-new-data-objects","dir":"","previous_headings":"Common Tasks","what":"Adding New Data Objects","title":"GitHub Copilot Instructions for afsetools Package","text":"Add data file inst/extdata/ (Excel format preferred) Update load_general_data() load new data Document R/data.R roxygen2 Add description DATA_REFERENCE.md **List _pkgdown.yml “Data Objects”**","code":""},{"path":"https://eduaguilera.github.io/afsetools/copilot-instructions.html","id":"updating-coefficients","dir":"","previous_headings":"Common Tasks","what":"Updating Coefficients","title":"GitHub Copilot Instructions for afsetools Package","text":"Update source file inst/extdata/ Document changes comments Verify downstream functions still work Update tests coefficient values changed Note changes NEWS.md","code":""},{"path":"https://eduaguilera.github.io/afsetools/copilot-instructions.html","id":"resources","dir":"","previous_headings":"","what":"Resources","title":"GitHub Copilot Instructions for afsetools Package","text":"Package website: https://eduaguilera.github.io/afsetools/ Tidyverse style guide: https://style.tidyverse.org/ R Packages book: https://r-pkgs.org/ roxygen2 documentation: https://roxygen2.r-lib.org/ pkgdown: https://pkgdown.r-lib.org/","code":""},{"path":"https://eduaguilera.github.io/afsetools/index.html","id":"afsetools-agro-food-system-and-environment-tools","dir":"","previous_headings":"","what":"Agro-Food System and Environment Tools","title":"Agro-Food System and Environment Tools","text":"afsetools (Agro-Food System Environment Tools) R package bundles standardized coefficients, classifications, functions calculating environmental footprints agro-food systems tracing global supply chains. shared analytical backbone several research projects global national food-system sustainability.","code":""},{"path":[]},{"path":[]},{"path":"https://eduaguilera.github.io/afsetools/index.html","id":"from-github-recommended","dir":"","previous_headings":"Installation","what":"From GitHub (recommended)","title":"Agro-Food System and Environment Tools","text":"","code":"# install.packages(\"devtools\") devtools::install_github(\"eduaguilera/afsetools\")"},{"path":"https://eduaguilera.github.io/afsetools/index.html","id":"from-source-development","dir":"","previous_headings":"Installation","what":"From source (development)","title":"Agro-Food System and Environment Tools","text":"","code":"git clone https://github.com/eduaguilera/afsetools.git # Then in R, from the parent directory: devtools::install(\"afsetools\")"},{"path":"https://eduaguilera.github.io/afsetools/index.html","id":"architecture","dir":"","previous_headings":"","what":"Architecture","title":"Agro-Food System and Environment Tools","text":"Unlike R packages, afsetools follows data-driven, environment-loading design. Understanding pattern essential using package correctly.","code":""},{"path":"https://eduaguilera.github.io/afsetools/index.html","id":"how-it-works","dir":"","previous_headings":"Architecture","what":"How it works","title":"Agro-Food System and Environment Tools","text":"Data files inst/extdata/ contain Excel tables coefficients classifications. load_general_data() reads files creates 73+ named objects calling environment (package namespace). Functions expect objects exist environment called. implicit dependencies — passed arguments. means must always call load_general_data() using functions:","code":"inst/extdata/*.xlsx          load_general_data()        Your analysis code ┌──────────────────┐    ┌──────────────────────┐    ┌──────────────────────┐ │ Codes_coefs.xlsx │───>│ Reads Excel files     │───>│ Biomass_coefs, GWP,  │ │ Biomass_coefs.xlsx│   │ Creates 73+ objects   │    │ BNF, items_full, ... │ │ BNF.xlsx         │   │ in calling environment│    │ available as objects  │ │ GWP.xlsx         │   └──────────────────────┘    │ in your environment   │ └──────────────────┘                                └──────────────────────┘                                                             │                                                             ▼                                                     ┌──────────────────────┐                                                     │ Functions reference   │                                                     │ these objects by name │                                                     │ (implicit dependency) │                                                     └──────────────────────┘ library(afsetools) load_general_data()          # Populates your environment with 73+ objects load_general_data(load_vectors = TRUE)  # Also loads color palettes and month vectors"},{"path":"https://eduaguilera.github.io/afsetools/index.html","id":"quick-start","dir":"","previous_headings":"","what":"Quick Start","title":"Agro-Food System and Environment Tools","text":"","code":"library(afsetools)  # Load all coefficients and classification data load_general_data()  # Now you have access to: # - Biomass_coefs: Conversion factors for DM, N, C, energy # - GWP: Global warming potentials for greenhouse gases # - BNF: Biological nitrogen fixation parameters # - items_full, regions_full: Harmonized nomenclatures # - And 60+ more data objects  # Calculate potential NPP from climate data npp <- calculate_potential_npp(climate_data)  # Calculate crop NPP components crop_npp <- calculate_crop_npp(crop_data, harvest_index)  # Run the full footprint pipeline # (requires workflow objects in environment: CBS, Primary_all, Impact_prod, etc.) footprints <- calculate_footprints()  # Access results primary_fp <- footprints$FP_prim final_fp   <- footprints$FP_final"},{"path":"https://eduaguilera.github.io/afsetools/index.html","id":"documentation","dir":"","previous_headings":"","what":"Documentation","title":"Agro-Food System and Environment Tools","text":"Online reference: eduaguilera.github.io/afsetools R: Data objects: See DATA_REFERENCE.md full catalogue 73+ objects created load_general_data().","code":"?load_general_data ?calculate_footprints ?calculate_potential_npp help(package = \"afsetools\")"},{"path":[]},{"path":[]},{"path":"https://eduaguilera.github.io/afsetools/index.html","id":"npp-calculation","dir":"","previous_headings":"Functions","what":"NPP Calculation","title":"Agro-Food System and Environment Tools","text":"Note naming: NPP functions recently renamed snake_case. old PascalCase names kept exported aliases backward compatibility.","code":""},{"path":[]},{"path":[]},{"path":[]},{"path":[]},{"path":[]},{"path":[]},{"path":[]},{"path":"https://eduaguilera.github.io/afsetools/index.html","id":"package-data","dir":"","previous_headings":"","what":"Package Data","title":"Agro-Food System and Environment Tools","text":"calling load_general_data(), ’ll access : Nomenclatures Classifications (~35 objects): items_full, items_prod_full, items_cbs, regions_full, regions_full_uISO3, Cats, Cats_proc, Primary_double, Secondary_double, 25+ classification tables. Biomass Coefficients (~17 objects): Biomass_coefs (main coefficient table: DM, N, C, energy content, root:shoot ratios, harvest indices), Root_ref, Weed_NPP_Scaling, Residue_Shares, Fallow_cover, 12+ . Global Warming Potentials (~7 objects): GWP, GWP_100, 5 gas-specific GWP tables. Biological N Fixation (3 objects): BNF, Names_BNF, Ndfa_ref. Derived Constants (6 scalars): Residue_kgC_kgDM_W, Root_kgC_kgDM_W, Residue_kgN_kgDM_W, Root_kgN_kgDM_W, Root_Shoot_ratio_W, Rhizod_kgN_kgRootN_W — derived Grass row Biomass_coefs. Color Palettes (loaded load_vectors = TRUE): Total_color, SOM_color, GHG_color, N_color, P_color, Land_color, Water_color, Energy_color, Month_names, Month_numbers.","code":""},{"path":"https://eduaguilera.github.io/afsetools/index.html","id":"data-files","dir":"","previous_headings":"Package Data","what":"Data Files","title":"Agro-Food System and Environment Tools","text":"raw input data shipped inst/extdata/:","code":""},{"path":"https://eduaguilera.github.io/afsetools/index.html","id":"example-workflow","dir":"","previous_headings":"","what":"Example Workflow","title":"Agro-Food System and Environment Tools","text":"","code":"library(afsetools) library(dplyr)  # 1. Load all data load_general_data()  # 2. Prepare your workflow objects in the environment: #    CBS, Primary_all, Impact_prod, Crop_NPPr_NoFallow, Feed_intake, #    Primary_prices, CBS_item_prices, Processing_coefs, Relative_residue_price  # 3. Calculate complete footprints #    Omit `dtm` for gross trade; pass dtm = your_trade_matrix for bilateral trade results <- calculate_footprints()  # 4. Visualize results library(ggplot2)  results$FP_final |>   dplyr::filter(Impact == \"GHG\", Year == 2020) |>   ggplot(aes(x = area, y = Impact_u, fill = Element)) +   geom_bar(stat = \"identity\") +   theme_new() +   labs(title = \"GHG Footprint by Product Group, 2020\")"},{"path":"https://eduaguilera.github.io/afsetools/index.html","id":"related-repositories","dir":"","previous_headings":"","what":"Related Repositories","title":"Agro-Food System and Environment Tools","text":"afsetools provides shared analytical core projects: repositories call library(afsetools) followed load_general_data(load_vectors = TRUE) rely functions data objects exported package.","code":""},{"path":"https://eduaguilera.github.io/afsetools/index.html","id":"dependencies","dir":"","previous_headings":"","what":"Dependencies","title":"Agro-Food System and Environment Tools","text":"Runtime (Imports): data.table, dplyr, ggplot2, rlang, readxl, openxlsx, tibble, tidyr, zoo Optional (Suggests): methods, raster, sf, testthat, knitr, rmarkdown, pkgdown Requires R ≥ 4.1.0 (native pipe |>).","code":""},{"path":"https://eduaguilera.github.io/afsetools/index.html","id":"citation","dir":"","previous_headings":"","what":"Citation","title":"Agro-Food System and Environment Tools","text":"use package research, please cite: Aguilera, E., et al. (2025). afsetools: Agro-Food System Environment Tools. R package version 0.1.4. https://github.com/eduaguilera/afsetools","code":""},{"path":"https://eduaguilera.github.io/afsetools/index.html","id":"license","dir":"","previous_headings":"","what":"License","title":"Agro-Food System and Environment Tools","text":"MIT © Eduardo Aguilera","code":""},{"path":"https://eduaguilera.github.io/afsetools/index.html","id":"author","dir":"","previous_headings":"","what":"Author","title":"Agro-Food System and Environment Tools","text":"Eduardo Aguilera (eduardo.aguilera@upm.es) ORCID: 0000-0002-0429-0883","code":""},{"path":"https://eduaguilera.github.io/afsetools/index.html","id":"contributing","dir":"","previous_headings":"","what":"Contributing","title":"Agro-Food System and Environment Tools","text":"Contributions welcome! Please see CONTRIBUTING.md guidelines.","code":""},{"path":"https://eduaguilera.github.io/afsetools/index.html","id":"development","dir":"","previous_headings":"","what":"Development","title":"Agro-Food System and Environment Tools","text":"","code":"# Clone the repository git clone https://github.com/eduaguilera/afsetools.git cd afsetools  # Install development dependencies devtools::install_dev_deps()  # Run tests devtools::test()  # Regenerate documentation devtools::document()  # Full R CMD check devtools::check()"},{"path":"https://eduaguilera.github.io/afsetools/reference/Agg_primary.html","id":null,"dir":"Reference","previous_headings":"","what":"Aggregate Primary Products to CBS Items — Agg_primary","title":"Aggregate Primary Products to CBS Items — Agg_primary","text":"Aggregates primary production footprints production items CBS (commodity balance sheet) items.","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/Agg_primary.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Aggregate Primary Products to CBS Items — Agg_primary","text":"","code":"Agg_primary(df)"},{"path":"https://eduaguilera.github.io/afsetools/reference/Agg_primary.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Aggregate Primary Products to CBS Items — Agg_primary","text":"df Primary product footprint data frame","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/Agg_primary.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Aggregate Primary Products to CBS Items — Agg_primary","text":"data frame footprints aggregated CBS item level","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/Agg_primary.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Aggregate Primary Products to CBS Items — Agg_primary","text":"","code":"if (FALSE) { # \\dontrun{ primary_cbs <- Agg_primary(primary_footprints) } # }"},{"path":"https://eduaguilera.github.io/afsetools/reference/Agg_processed.html","id":null,"dir":"Reference","previous_headings":"","what":"Aggregate Processed Products from Countries to Origins — Agg_processed","title":"Aggregate Processed Products from Countries to Origins — Agg_processed","text":"Aggregates processed product footprints country-level origin-level.","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/Agg_processed.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Aggregate Processed Products from Countries to Origins — Agg_processed","text":"","code":"Agg_processed(df)"},{"path":"https://eduaguilera.github.io/afsetools/reference/Agg_processed.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Aggregate Processed Products from Countries to Origins — Agg_processed","text":"df Processed product footprint data frame","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/Agg_processed.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Aggregate Processed Products from Countries to Origins — Agg_processed","text":"data frame processed footprints aggregated origin","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/Agg_processed.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Aggregate Processed Products from Countries to Origins — Agg_processed","text":"","code":"if (FALSE) { # \\dontrun{ processed_agg <- Agg_processed(processed_footprints) } # }"},{"path":"https://eduaguilera.github.io/afsetools/reference/Allocate_impacts_to_products.html","id":null,"dir":"Reference","previous_headings":"","what":"Allocate Impacts to Products Based on Economic Value — Allocate_impacts_to_products","title":"Allocate Impacts to Products Based on Economic Value — Allocate_impacts_to_products","text":"Performs economic allocation environmental impacts among co-products (e.g., cotton lint cottonseed) creates draught animal items.","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/Allocate_impacts_to_products.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Allocate Impacts to Products Based on Economic Value — Allocate_impacts_to_products","text":"","code":"Allocate_impacts_to_products(df, draught_shares)"},{"path":"https://eduaguilera.github.io/afsetools/reference/Allocate_impacts_to_products.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Allocate Impacts to Products Based on Economic Value — Allocate_impacts_to_products","text":"df data frame impact data products draught_shares Draught animal allocation shares `Year`, `area`, `Live_anim`","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/Allocate_impacts_to_products.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Allocate Impacts to Products Based on Economic Value — Allocate_impacts_to_products","text":"data frame allocated impacts (Allocation, Impact_u, u_ton columns added)","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/Allocate_impacts_to_products.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Allocate Impacts to Products Based on Economic Value — Allocate_impacts_to_products","text":"","code":"if (FALSE) { # \\dontrun{ allocated_impacts <- Allocate_impacts_to_products(impact_data, draught_shares) } # }"},{"path":"https://eduaguilera.github.io/afsetools/reference/Arrange_dates.html","id":null,"dir":"Reference","previous_headings":"","what":"Arrange data by dates — Arrange_dates","title":"Arrange data by dates — Arrange_dates","text":"Creates dates based years months, arranges date. Requires Month_numbers object Month_names Month_number columns.","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/Arrange_dates.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Arrange data by dates — Arrange_dates","text":"","code":"Arrange_dates(x)"},{"path":"https://eduaguilera.github.io/afsetools/reference/Arrange_dates.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Arrange data by dates — Arrange_dates","text":"x Data frame Year Month_names columns","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/Arrange_dates.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Arrange data by dates — Arrange_dates","text":"Data frame arranged date additional date columns","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/Arrange_dates.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Arrange data by dates — Arrange_dates","text":"Remember group data needed using function. Requires Month_numbers Month_order objects load_general_data().","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/BNF.html","id":null,"dir":"Reference","previous_headings":"","what":"Biological Nitrogen Fixation Parameters — BNF","title":"Biological Nitrogen Fixation Parameters — BNF","text":"Parameters calculating biological nitrogen fixation crop type, including symbiotic non-symbiotic fixation.","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/BNF.html","id":"format","dir":"Reference","previous_headings":"","what":"Format","title":"Biological Nitrogen Fixation Parameters — BNF","text":"data frame BNF coefficients: Name_BNF Crop system name Ndfa Proportion nitrogen derived atmosphere (0-1) Leguminous_share Fraction leguminous species (0-1) BGN -ground nitrogen parameter NHI Nitrogen harvest index","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/BNF.html","id":"source","dir":"Reference","previous_headings":"","what":"Source","title":"Biological Nitrogen Fixation Parameters — BNF","text":"Scientific literature compilation","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/Biomass_coefs.html","id":null,"dir":"Reference","previous_headings":"","what":"Biomass Coefficients — Biomass_coefs","title":"Biomass Coefficients — Biomass_coefs","text":"Main coefficient table containing dry matter, nitrogen, carbon, energy content different biomass types. Used converting different biomass units.","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/Biomass_coefs.html","id":"format","dir":"Reference","previous_headings":"","what":"Format","title":"Biomass Coefficients — Biomass_coefs","text":"data frame coefficients biomass conversion including: item Item code name DM_content Dry matter content (fraction) N_content Nitrogen content (kg N / kg DM) C_content Carbon content (kg C / kg DM) energy_MJ_kg Energy content (MJ / kg)","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/Biomass_coefs.html","id":"source","dir":"Reference","previous_headings":"","what":"Source","title":"Biomass Coefficients — Biomass_coefs","text":"Harmonized multiple scientific databases literature","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/Calc_N_fix.html","id":null,"dir":"Reference","previous_headings":"","what":"Biological Nitrogen Fixation (Legacy Wrapper) — Calc_N_fix","title":"Biological Nitrogen Fixation (Legacy Wrapper) — Calc_N_fix","text":"Legacy wrapper around calc_bnf backward compatibility. New code use calc_bnf directly, adds literature-based environmental modifiers N inputs, temperature, water stress, soil organic matter, soil pH.","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/Calc_N_fix.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Biological Nitrogen Fixation (Legacy Wrapper) — Calc_N_fix","text":"","code":"Calc_N_fix(x)"},{"path":"https://eduaguilera.github.io/afsetools/reference/Calc_N_fix.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Biological Nitrogen Fixation (Legacy Wrapper) — Calc_N_fix","text":"x data frame crop NPP data including columns: Crop_NPP_MgN, Prod_MgN, Weeds_NPP_MgN, LandUse, Area_ygpit_ha, Legs_Seeded, Seeded_CC_share, Name_biomass","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/Calc_N_fix.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Biological Nitrogen Fixation (Legacy Wrapper) — Calc_N_fix","text":"data frame BNF calculations: CropBNF, WeedsBNF,   NSBNF, total BNF","code":""},{"path":[]},{"path":"https://eduaguilera.github.io/afsetools/reference/Calc_N_fix.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Biological Nitrogen Fixation (Legacy Wrapper) — Calc_N_fix","text":"","code":"if (FALSE) { # \\dontrun{ bnf_results <- Calc_N_fix(npp_data) # Prefer: bnf_results <- calc_bnf(npp_data) } # }"},{"path":"https://eduaguilera.github.io/afsetools/reference/Calc_diets.html","id":null,"dir":"Reference","previous_headings":"","what":"Calculate Nutrient Composition of Diets — Calc_diets","title":"Calculate Nutrient Composition of Diets — Calc_diets","text":"Calculates nutrient composition diets including energy, protein, lipids, carbohydrates, calcium, vitamin .","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/Calc_diets.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Calculate Nutrient Composition of Diets — Calc_diets","text":"","code":"Calc_diets(PIE_dest_df, Pop)"},{"path":"https://eduaguilera.github.io/afsetools/reference/Calc_diets.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Calculate Nutrient Composition of Diets — Calc_diets","text":"PIE_dest_df data frame food destiny data (columns: Year, area, item_cbs, Element, Destiny, FM_Mg) Pop data frame population data (columns: Year, area, Pop_Mpeop)","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/Calc_diets.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Calculate Nutrient Composition of Diets — Calc_diets","text":"data frame dietary nutrient availability per capita per day","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/Calc_diets.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Calculate Nutrient Composition of Diets — Calc_diets","text":"","code":"if (FALSE) { # \\dontrun{ diet_nutrients <- Calc_diets(food_destiny_data, population_data) } # }"},{"path":"https://eduaguilera.github.io/afsetools/reference/Calc_impact_processed.html","id":null,"dir":"Reference","previous_headings":"","what":"Calculate Embodied Impact of Processed Products — Calc_impact_processed","title":"Calculate Embodied Impact of Processed Products — Calc_impact_processed","text":"Traces impacts processing chains using processing shares conversion coefficients.","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/Calc_impact_processed.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Calculate Embodied Impact of Processed Products — Calc_impact_processed","text":"","code":"Calc_impact_processed(df, processing_shares)"},{"path":"https://eduaguilera.github.io/afsetools/reference/Calc_impact_processed.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Calculate Embodied Impact of Processed Products — Calc_impact_processed","text":"df Product footprint data frame processing_shares Processing shares table","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/Calc_impact_processed.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Calculate Embodied Impact of Processed Products — Calc_impact_processed","text":"data frame processed product footprints","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/Calc_impact_processed.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Calculate Embodied Impact of Processed Products — Calc_impact_processed","text":"","code":"if (FALSE) { # \\dontrun{ processed_fp <- Calc_impact_processed(primary_footprints, processing_shares) } # }"},{"path":"https://eduaguilera.github.io/afsetools/reference/GWP.html","id":null,"dir":"Reference","previous_headings":"","what":"Global Warming Potentials — GWP","title":"Global Warming Potentials — GWP","text":"GWP values different greenhouse gases time horizons based IPCC guidelines.","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/GWP.html","id":"format","dir":"Reference","previous_headings":"","what":"Format","title":"Global Warming Potentials — GWP","text":"data frame GWP values: Gas Greenhouse gas name GWP_20 20-year global warming potential GWP_100 100-year global warming potential (commonly used) GWP_500 500-year global warming potential","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/GWP.html","id":"source","dir":"Reference","previous_headings":"","what":"Source","title":"Global Warming Potentials — GWP","text":"IPCC Assessment Reports","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/Gases_GWP.html","id":null,"dir":"Reference","previous_headings":"","what":"Classify GHG Emissions and Calculate Global Warming Potential — Gases_GWP","title":"Classify GHG Emissions and Calculate Global Warming Potential — Gases_GWP","text":"Classifies greenhouse gas emissions calculates GWP100 CO2 equivalents.","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/Gases_GWP.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Classify GHG Emissions and Calculate Global Warming Potential — Gases_GWP","text":"","code":"Gases_GWP(x)"},{"path":"https://eduaguilera.github.io/afsetools/reference/Gases_GWP.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Classify GHG Emissions and Calculate Global Warming Potential — Gases_GWP","text":"x data frame columns: Gas_raw, Gas_type, value","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/Gases_GWP.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Classify GHG Emissions and Calculate Global Warming Potential — Gases_GWP","text":"data frame Gas, Gas_categ, CO2e_Tg calculated","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/Gases_GWP.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Classify GHG Emissions and Calculate Global Warming Potential — Gases_GWP","text":"","code":"if (FALSE) { # \\dontrun{ ghg_with_gwp <- Gases_GWP(emissions_data) } # }"},{"path":"https://eduaguilera.github.io/afsetools/reference/IPCC_crop_mapping.html","id":null,"dir":"Reference","previous_headings":"","what":"IPCC Crop Name Mapping — IPCC_crop_mapping","title":"IPCC Crop Name Mapping — IPCC_crop_mapping","text":"Maps Name_biomass crop classifications Biomass_coefs IPCC crop categories used IPCC_residue_coefs IPCC_root_coefs.","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/IPCC_crop_mapping.html","id":"format","dir":"Reference","previous_headings":"","what":"Format","title":"IPCC Crop Name Mapping — IPCC_crop_mapping","text":"data frame columns: Name_biomass Crop name matching Biomass_coefs classification. IPCC_crop Corresponding IPCC crop category.","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/IPCC_crop_mapping.html","id":"source","dir":"Reference","previous_headings":"","what":"Source","title":"IPCC Crop Name Mapping — IPCC_crop_mapping","text":"Package-internal mapping based IPCC crop categories.","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/IPCC_residue_coefs.html","id":null,"dir":"Reference","previous_headings":"","what":"IPCC Crop Residue Coefficients — IPCC_residue_coefs","title":"IPCC Crop Residue Coefficients — IPCC_residue_coefs","text":"Linear model coefficients estimating -ground crop residue biomass yield, based IPCC 2019 Refinement guidelines (Vol.4, Ch.11, Table 11.1a).","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/IPCC_residue_coefs.html","id":"format","dir":"Reference","previous_headings":"","what":"Format","title":"IPCC Crop Residue Coefficients — IPCC_residue_coefs","text":"data frame columns: IPCC_crop IPCC crop category name. Slope_AG Slope linear residue model (Mg DM residue per     Mg DM yield per hectare). Intercept_AG_MgDMha Intercept (Mg DM / ha), representing     structural baseline residue production. RS_ratio_IPCC Default root--shoot ratio IPCC. N_AG_residue Nitrogen content -ground residue     (kg N / kg DM). N_BG_residue Nitrogen content -ground residue     (kg N / kg DM). Source Literature source reference.","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/IPCC_residue_coefs.html","id":"source","dir":"Reference","previous_headings":"","what":"Source","title":"IPCC Crop Residue Coefficients — IPCC_residue_coefs","text":"IPCC (2019) 2019 Refinement 2006 IPCC Guidelines,   Vol.4, Ch.11, Table 11.1a. Bolinder et al. (2007). Gan et al. (2009).","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/IPCC_root_coefs.html","id":null,"dir":"Reference","previous_headings":"","what":"IPCC Root Biomass Coefficients — IPCC_root_coefs","title":"IPCC Root Biomass Coefficients — IPCC_root_coefs","text":"Root--shoot ratios reference root biomass values estimating -ground crop biomass, adjustments N input irrigation.","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/IPCC_root_coefs.html","id":"format","dir":"Reference","previous_headings":"","what":"Format","title":"IPCC Root Biomass Coefficients — IPCC_root_coefs","text":"data frame columns: IPCC_crop IPCC crop category name. RS_default Default root--shoot ratio. RS_low_N RS ratio low N input (<60 kg N/ha). RS_high_N RS ratio high N input (>120 kg N/ha). RS_irrigated RS ratio irrigation. RS_rainfed RS ratio rainfed conditions. BG_ref_MgDMha Reference -ground biomass (Mg DM / ha). Source Literature source reference.","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/IPCC_root_coefs.html","id":"source","dir":"Reference","previous_headings":"","what":"Source","title":"IPCC Root Biomass Coefficients — IPCC_root_coefs","text":"IPCC (2019) 2019 Refinement, Vol.4, Ch.11. Bolinder et al.   (2007). Poorter & Nagel (2000). Benjamin et al. (2014).","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/Irrigation_adj.html","id":null,"dir":"Reference","previous_headings":"","what":"Irrigation Adjustment Factors — Irrigation_adj","title":"Irrigation Adjustment Factors — Irrigation_adj","text":"Adjustment factors residue:product ratio root:shoot ratio different water management regimes.","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/Irrigation_adj.html","id":"format","dir":"Reference","previous_headings":"","what":"Format","title":"Irrigation Adjustment Factors — Irrigation_adj","text":"data frame columns: Water_regime Water management (Irrigated, Rainfed, Mixed). Residue_ratio_factor Multiplicative factor residue:product     ratio (irrigated crops higher HI, less residue). RS_ratio_factor Multiplicative factor root:shoot ratio     (irrigated crops shallower roots). Source Literature source reference.","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/Irrigation_adj.html","id":"source","dir":"Reference","previous_headings":"","what":"Source","title":"Irrigation Adjustment Factors — Irrigation_adj","text":"Sadras (2007) Field Crops Research 100:125-138.   Zhang et al. (2019). Benjamin et al. (2014).","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/Modern_variety_adoption.html","id":null,"dir":"Reference","previous_headings":"","what":"Modern Variety Adoption Timeline — Modern_variety_adoption","title":"Modern Variety Adoption Timeline — Modern_variety_adoption","text":"Regional time-series modern (high-yielding) variety adoption shares effect harvest index. Used correct residue:product ratios historical periods traditional varieties dominated.","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/Modern_variety_adoption.html","id":"format","dir":"Reference","previous_headings":"","what":"Format","title":"Modern Variety Adoption Timeline — Modern_variety_adoption","text":"data frame columns: region_HANPP World region name (8 regions). Year Year (decadal 1900 2020). Modern_share Share area modern varieties (0-1). HI_correction_factor Multiplicative correction     residue:product ratio (>1 = residue traditional systems).","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/Modern_variety_adoption.html","id":"source","dir":"Reference","previous_headings":"","what":"Source","title":"Modern Variety Adoption Timeline — Modern_variety_adoption","text":"Evenson & Gollin (2003) Science 300:758-762.   Krausmann et al. (2013) Global Env Change 23:1170-1181.   Pingali (2012) PNAS 109:12302-12308.","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/N_input_RS_adj.html","id":null,"dir":"Reference","previous_headings":"","what":"N Input Root:Shoot Adjustment Factors — N_input_RS_adj","title":"N Input Root:Shoot Adjustment Factors — N_input_RS_adj","text":"Adjustment factors root--shoot ratios based nitrogen input levels. Higher N availability reduces root allocation (functional equilibrium theory).","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/N_input_RS_adj.html","id":"format","dir":"Reference","previous_headings":"","what":"Format","title":"N Input Root:Shoot Adjustment Factors — N_input_RS_adj","text":"data frame columns: N_input_class N application category name. N_input_min Lower bound N rate (kg N/ha/yr). N_input_max Upper bound N rate (kg N/ha/yr). RS_adjustment Multiplicative factor default RS ratio. Source Literature source reference.","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/N_input_RS_adj.html","id":"source","dir":"Reference","previous_headings":"","what":"Source","title":"N Input Root:Shoot Adjustment Factors — N_input_RS_adj","text":"Poorter & Nagel (2000) New Phytologist 147:135-147.","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/Prepare_prim.html","id":null,"dir":"Reference","previous_headings":"","what":"Impact Tracing Functions — Prepare_prim","title":"Impact Tracing Functions — Prepare_prim","text":"Functions trace environmental impacts supply chains primary production processed products, accounting trade economic allocation. Prepare Primary Production Database","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/Prepare_prim.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Impact Tracing Functions — Prepare_prim","text":"","code":"Prepare_prim(Prim_all)"},{"path":"https://eduaguilera.github.io/afsetools/reference/Prepare_prim.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Impact Tracing Functions — Prepare_prim","text":"Prim_all Primary production data frame columns: unit, item_prod, item_code_prod, Value","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/Prepare_prim.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Impact Tracing Functions — Prepare_prim","text":"data frame item_code_impact added joining impact data","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/Prepare_prim.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Impact Tracing Functions — Prepare_prim","text":"Prepares primary production database adding impact codes filtering multi-products (cotton, oil palm, etc.).","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/Prepare_prim.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Impact Tracing Functions — Prepare_prim","text":"","code":"if (FALSE) { # \\dontrun{ primary_data <- Prepare_prim(Primary_all) } # }"},{"path":"https://eduaguilera.github.io/afsetools/reference/add_xlsx_sheet.html","id":null,"dir":"Reference","previous_headings":"","what":"Add sheet to existing Excel workbook — add_xlsx_sheet","title":"Add sheet to existing Excel workbook — add_xlsx_sheet","text":"Adds new sheet existing Excel workbook. sheet must exist previously.","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/add_xlsx_sheet.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Add sheet to existing Excel workbook — add_xlsx_sheet","text":"","code":"add_xlsx_sheet(wb_location, newsheet_name, newsheet_data)"},{"path":"https://eduaguilera.github.io/afsetools/reference/add_xlsx_sheet.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Add sheet to existing Excel workbook — add_xlsx_sheet","text":"wb_location Character string path Excel workbook newsheet_name Character string name new sheet newsheet_data Data frame write new sheet","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/add_xlsx_sheet.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Add sheet to existing Excel workbook — add_xlsx_sheet","text":"NULL (modifies workbook file place)","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/afsetools-data.html","id":null,"dir":"Reference","previous_headings":"","what":"Data Objects Loaded by load_general_data() — afsetools-data","title":"Data Objects Loaded by load_general_data() — afsetools-data","text":"package contains 79+ data objects loaded environment call load_general_data(). include nomenclatures, biomass coefficients, global warming potentials, IPCC crop residue root coefficients, parameters needed environmental footprint calculations.","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/afsetools-data.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Data Objects Loaded by load_general_data() — afsetools-data","text":"data objects include: 35 nomenclature classification objects 17 biomass coefficient objects 6 IPCC residue/root coefficient objects 7 global warming potential objects 3 biological nitrogen fixation objects 6 constants scalars Color palettes utility vectors complete documentation data objects, see DATA_REFERENCE.md file package repository, use ?object_name specific objects loading load_general_data().","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/biomass_functions.html","id":null,"dir":"Reference","previous_headings":"","what":"Biomass Processing Functions — biomass_functions","title":"Biomass Processing Functions — biomass_functions","text":"Functions processing biomass data including fallow integration, residue classification, residue use calculations.","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/calc_avail_fp_dtm.html","id":null,"dir":"Reference","previous_headings":"","what":"Calculate Available Footprint Using Detailed Trade Matrix — calc_avail_fp_dtm","title":"Calculate Available Footprint Using Detailed Trade Matrix — calc_avail_fp_dtm","text":"Calculates footprint product availability using bilateral trade data (DTM).","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/calc_avail_fp_dtm.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Calculate Available Footprint Using Detailed Trade Matrix — calc_avail_fp_dtm","text":"","code":"calc_avail_fp_dtm(filtered_cbs, df, cbs, dtm, impact_prod)"},{"path":"https://eduaguilera.github.io/afsetools/reference/calc_avail_fp_dtm.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Calculate Available Footprint Using Detailed Trade Matrix — calc_avail_fp_dtm","text":"filtered_cbs Filtered CBS data production import df Product footprint data frame cbs Commodity balance sheet data dtm Detailed trade matrix data impact_prod Production impact table (new schema `area`, `area_code`; used `Year`/`Impact` coverage)","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/calc_avail_fp_dtm.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Calculate Available Footprint Using Detailed Trade Matrix — calc_avail_fp_dtm","text":"data frame availability footprints including bilateral import footprints","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/calc_avail_fp_dtm.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Calculate Available Footprint Using Detailed Trade Matrix — calc_avail_fp_dtm","text":"","code":"if (FALSE) { # \\dontrun{ avail_fp <- calc_avail_fp_dtm(filtered_cbs, product_footprints, cbs, dtm, impact_prod) } # }"},{"path":"https://eduaguilera.github.io/afsetools/reference/calc_avail_fp_gt.html","id":null,"dir":"Reference","previous_headings":"","what":"Calculate Available Footprint Using Gross Trade — calc_avail_fp_gt","title":"Calculate Available Footprint Using Gross Trade — calc_avail_fp_gt","text":"Calculates footprint product availability (production + import) using gross trade data (bilateral trade detail).","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/calc_avail_fp_gt.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Calculate Available Footprint Using Gross Trade — calc_avail_fp_gt","text":"","code":"calc_avail_fp_gt(filtered_cbs, df, cbs)"},{"path":"https://eduaguilera.github.io/afsetools/reference/calc_avail_fp_gt.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Calculate Available Footprint Using Gross Trade — calc_avail_fp_gt","text":"filtered_cbs Filtered CBS data production import df Product footprint data frame cbs Commodity balance sheet data","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/calc_avail_fp_gt.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Calculate Available Footprint Using Gross Trade — calc_avail_fp_gt","text":"data frame availability footprints including imports","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/calc_avail_fp_gt.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Calculate Available Footprint Using Gross Trade — calc_avail_fp_gt","text":"","code":"if (FALSE) { # \\dontrun{ avail_fp <- calc_avail_fp_gt(filtered_cbs, product_footprints, cbs) } # }"},{"path":"https://eduaguilera.github.io/afsetools/reference/calc_bnf.html","id":null,"dir":"Reference","previous_headings":"","what":"Calculate Total Biological Nitrogen Fixation — calc_bnf","title":"Calculate Total Biological Nitrogen Fixation — calc_bnf","text":"Total BNF sum three components: $$BNF = CropBNF + WeedsBNF + NSBNF$$ component estimated using reference parameters BNF data table, optionally adjusted local environmental conditions (N inputs, temperature, moisture, SOM, pH) variables present input data. **environmental columns present**, function produces results comparable `Calc_N_fix()` (adjustment factors = 1), ensuring backward compatibility.","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/calc_bnf.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Calculate Total Biological Nitrogen Fixation — calc_bnf","text":"","code":"calc_bnf(   x,   k_n_symb_synth = 0.0035,   k_n_symb_org = 0.0018,   k_n_ns_synth = 0.005,   k_n_ns_org = 0.0025,   t_opt = 25,   t_sigma_symb = 8,   t_sigma_ns = 10,   nsbnf_default_kgha = 5,   k_som = 2,   som_ref = 2.5,   ph_opt = 6.8,   ph_sigma = 1.5,   k_clay = 20,   clay_ref = 25 )"},{"path":"https://eduaguilera.github.io/afsetools/reference/calc_bnf.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Calculate Total Biological Nitrogen Fixation — calc_bnf","text":"x Data frame crop NPP area data. Required columns: Name_biomass Crop name matching Names_BNF. Crop_NPP_MgN Crop NPP Mg N. Prod_MgN Product nitrogen Mg. Weeds_NPP_MgN Weed NPP Mg N. LandUse Land use type (Cropland, etc.). Area_ygpit_ha Harvested area hectares. Legs_Seeded Legume fraction seeded cover crops. Seeded_CC_share Share area seeded CCs. Optional environmental columns (auto-detected): N_synth_kgha Synthetic N fertilizer (kg N/ha). N_org_kgha Organic N inputs (kg N/ha). TMP Mean temperature (degrees C). WaterInput_mm Water input (mm). provide precip_mm       optionally irrig_mm. PET_mm Potential evapotranspiration (mm). SOM_pct Soil organic matter (percent). soil_pH Soil pH. k_n_symb_synth Numeric. Synthetic N inhibition constant symbiotic BNF (default 0.0035). k_n_symb_org Numeric. Organic N inhibition constant symbiotic BNF (default 0.0018). k_n_ns_synth Numeric. Synthetic N inhibition constant non-symbiotic BNF (default 0.005). k_n_ns_org Numeric. Organic N inhibition constant non-symbiotic BNF (default 0.0025). t_opt Numeric. Optimal temperature (default 25). t_sigma_symb Numeric. Temperature width symbiotic (default 8). t_sigma_ns Numeric. Temperature width non-symbiotic (default 10). nsbnf_default_kgha Numeric. Default NSBNF base rate (default 5 kg N/ha/yr). k_som Numeric. SOM half-saturation (default 2.0). som_ref Numeric. Reference SOM (default 2.5). ph_opt Numeric. Optimal pH (default 6.8). ph_sigma Numeric. pH Gaussian width (default 1.5). k_clay Numeric. Clay half-saturation NSBNF (default 20). clay_ref Numeric. Reference clay percent (default 25).","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/calc_bnf.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Calculate Total Biological Nitrogen Fixation — calc_bnf","text":"Data frame intermediate columns plus: Fert_type \"BNF\" character flag. CropBNF Symbiotic crop BNF, NPP method (Mg N). CropBNF2 Symbiotic crop BNF, Anglade method (Mg N). WeedsBNF Symbiotic weed/cover crop BNF (Mg N). NSBNF Non-symbiotic BNF (Mg N). BNF Total BNF (Mg N). f_N_symb, f_temp_symb, f_water_symb Symbiotic       adjustment factors. f_N_ns, f_temp_ns, f_water_ns, f_SOM_ns,       f_pH_ns, f_clay_ns Non-symbiotic adjustment factors.","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/calc_bnf.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Calculate Total Biological Nitrogen Fixation — calc_bnf","text":"Master function calculates BNF components (symbiotic crop, symbiotic weed/cover crop, non-symbiotic) using literature-based environmental modifiers. Replaces improves upon `Calc_N_fix()`. ## Symbiotic BNF (crop legumes) Two methods calculated parallel: - **NPP method**: Uses total crop NPP nitrogen Ndfa. - **Anglade method**: Uses product nitrogen -ground N   (BGN) N harvest index (NHI) corrections. Ndfa adjusted N fertilization, temperature, water. ## Symbiotic BNF (weeds cover crops) Based weed NPP nitrogen, legume share weighted average spontaneous weeds seeded cover crops. environmental adjustments crop legume BNF. ## Non-symbiotic BNF Base rate BNF table (rice 33, sugarcane 25 kg N/ha/yr) default (5 kg N/ha/yr). Adjusted : - N inputs (free-living fixers avoid fixation cost N   available) - Temperature (broad Gaussian, sigma = 10) - Water (aridity index threshold) - SOM (C energy heterotrophic fixers, Michaelis-Menten) - pH (Gaussian around 6.8)","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/calc_bnf.html","id":"references","dir":"Reference","previous_headings":"","what":"References","title":"Calculate Total Biological Nitrogen Fixation — calc_bnf","text":"Anglade J et al. (2015) Nutr. Cycl. Agroecosyst. 103:37-56. Cleveland CC et al. (1999) Global Biogeochem. Cycles 13:623-645. Dynarski KA, Houlton BZ (2018) New Phytologist 217:68-85. Herridge DF et al. (2008) Plant Soil 311:1-18. Hungria M, Vargas MAT (2000) Field Crops Res. 65:151-164. Ladha JK et al. (2016) Scientific Reports 6:19355. Peoples MB et al. (2009) Symbiosis 48:1-17. Reed SC et al. (2011) Annu. Rev. Ecol. Evol. Syst. 42:489-512. Salvagiotti F et al. (2008) Field Crops Res. 108:1-13. Serraj R et al. (1999) Plant Physiology 120:577-586. Urquiaga S et al. (2012) Plant Soil 356:5-21.","code":""},{"path":[]},{"path":"https://eduaguilera.github.io/afsetools/reference/calc_bnf.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Calculate Total Biological Nitrogen Fixation — calc_bnf","text":"","code":"if (FALSE) { # \\dontrun{ load_general_data()  # Backward-compatible usage (no environmental data): bnf_results <- npp_data |> calc_bnf()  # With full environmental characterisation: bnf_results <- npp_data |>   dplyr::mutate(     N_synth_kgha = 80, N_org_kgha = 20,     TMP = 18, precip_mm = 650, irrig_mm = 100,     PET_mm = 900, SOM_pct = 3.0, soil_pH = 6.5   ) |>   calc_bnf() } # }"},{"path":"https://eduaguilera.github.io/afsetools/reference/calc_crop_bnf.html","id":null,"dir":"Reference","previous_headings":"","what":"Calculate Crop Legume Symbiotic BNF — calc_crop_bnf","title":"Calculate Crop Legume Symbiotic BNF — calc_crop_bnf","text":"Two estimation methods calculated simultaneously: 1. **NPP method** (`CropBNF`): Based total crop nitrogen NPP    estimation:    $$CropBNF = Crop\\_NPP\\_MgN \\times Ndfa_{adj} \\times Leg\\_share$$ 2. **Anglade method** (`CropBNF2`): Based product nitrogen,    -ground N (BGN), nitrogen harvest index (NHI) following    Anglade et al. (2015) Lassaletta et al. (2014):    $$CropBNF2 = Prod\\_MgN \\times Leg\\_share \\times Ndfa_{adj}    \\times BGN / NHI$$ environmental columns available, reference Ndfa adjusted: $$Ndfa_{adj} = Ndfa_{ref} \\times f_N \\times f_T \\times f_W$$","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/calc_crop_bnf.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Calculate Crop Legume Symbiotic BNF — calc_crop_bnf","text":"","code":"calc_crop_bnf(x, k_n_synth = 0.0035, k_n_org = 0.0018, t_opt = 25, t_sigma = 8)"},{"path":"https://eduaguilera.github.io/afsetools/reference/calc_crop_bnf.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Calculate Crop Legume Symbiotic BNF — calc_crop_bnf","text":"x Data frame crop NPP data. Required columns: Name_biomass Crop name matching Names_BNF classification. Crop_NPP_MgN Crop NPP Mg N. Prod_MgN Product nitrogen Mg. Optional environmental columns (absent, adjustment applied): N_synth_kgha Synthetic N fertilizer (kg N/ha). N_org_kgha Organic N inputs (kg N/ha). TMP Mean temperature (degrees C). WaterInput_mm Precipitation + irrigation (mm). Computed       precip_mm + irrig_mm absent. precip_mm Precipitation (mm). irrig_mm Irrigation water applied (mm). PET_mm Potential evapotranspiration (mm). k_n_synth Numeric. Rate constant N inhibition synthetic N (default 0.0035). 200 kg synthetic N/ha, Ndfa reduces ~50 percent reference. k_n_org Numeric. Rate constant N inhibition organic N (default 0.0018). Weaker synthetic organic N mineralizes slowly (Peoples et al. 2009). t_opt Numeric. Optimal temperature nitrogenase (default 25 degrees C). t_sigma Numeric. Width temperature Gaussian (default 8).","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/calc_crop_bnf.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Calculate Crop Legume Symbiotic BNF — calc_crop_bnf","text":"Data frame added columns: Ndfa, NHI, BGN, Leguminous_share BNF parameters. N_total_kgha Total N input (synthetic + organic). f_N_symb N inhibition factor (0-1). f_temp_symb Temperature factor (0-1). f_water_symb Water availability factor (0-1). f_env_symb Combined environmental factor. Ndfa_adj Adjusted Ndfa environmental correction. CropBNF Crop BNF via NPP method (Mg N). CropBNF2 Crop BNF via Anglade method (Mg N). Alpha1, Alpha2 BNF per unit product N.","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/calc_crop_bnf.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Calculate Crop Legume Symbiotic BNF — calc_crop_bnf","text":"Estimates symbiotic biological nitrogen fixation crop legumes using two complementary methods, optional environmental adjustments nitrogen fertilization, temperature, water availability. **N fertilizer inhibition**: Mineral N inhibits nitrogenase nodule formation (Salvagiotti et al. 2008; Streeter & Wong 1988). Synthetic N inhibits strongly organic N: $$f_N = \\exp(-k_{synth} \\times N_{synth} - k_{org} \\times   N_{org})$$ **Temperature**: Gaussian centred T_opt, reflecting thermal sensitivity nitrogenase (Hungria & Vargas 2000): $$f_T = \\exp\\left(-\\frac{(T - T_{opt})^2}{2   \\sigma^2}\\right)$$ **Water stress**: BNF declines drought via carbon oxygen effects nodules (Serraj et al. 1999). Modelled via aridity index: $$f_W = \\min(1, \\text{AI} / 0.65)$$ Requires `Names_BNF` `BNF` objects `load_general_data()`.","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/calc_crop_bnf.html","id":"references","dir":"Reference","previous_headings":"","what":"References","title":"Calculate Crop Legume Symbiotic BNF — calc_crop_bnf","text":"Anglade J et al. (2015) Nutrient Cycling Agroecosystems   103:37-56. Hungria M, Vargas MAT (2000) Field Crops Research 65:151-164. Lassaletta L et al. (2014) Biogeosciences 11:2889-2907. Salvagiotti F et al. (2008) Field Crops Research 108:1-13. Serraj R et al. (1999) Plant Physiology 120:577-586.","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/calc_crop_bnf.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Calculate Crop Legume Symbiotic BNF — calc_crop_bnf","text":"","code":"if (FALSE) { # \\dontrun{ load_general_data() # Basic usage (no environmental adjustment): crop_data |> calc_crop_bnf()  # With environmental data: crop_data |>   dplyr::mutate(     N_synth_kgha = 80, TMP = 18,     precip_mm = 600, PET_mm = 900   ) |>   calc_crop_bnf() } # }"},{"path":"https://eduaguilera.github.io/afsetools/reference/calc_nonsymbiotic_bnf.html","id":null,"dir":"Reference","previous_headings":"","what":"Calculate Non-Symbiotic BNF — calc_nonsymbiotic_bnf","title":"Calculate Non-Symbiotic BNF — calc_nonsymbiotic_bnf","text":"Non-symbiotic BNF (NSBNF) performed free-living soil bacteria (e.g. Azotobacter, Clostridium), associative bacteria rhizosphere (e.g. Azospirillum), cyanobacteria paddy soils, endophytic bacteria (e.g. Gluconacetobacter sugarcane). model calculates: $$NSBNF = NSBNF_{base} \\times f_N \\times f_T \\times f_W   \\times f_{SOM} \\times f_{pH} \\times Area / 1000$$ \\(NSBNF_{base}\\) comes BNF data table (crop-specific: rice 33, sugarcane 25 kg N/ha/yr) default rate general cropland.","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/calc_nonsymbiotic_bnf.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Calculate Non-Symbiotic BNF — calc_nonsymbiotic_bnf","text":"","code":"calc_nonsymbiotic_bnf(   x,   nsbnf_default_kgha = 5,   k_n_ns_synth = 0.005,   k_n_ns_org = 0.0025,   t_opt_ns = 25,   t_sigma_ns = 10,   k_som = 2,   som_ref = 2.5,   ph_opt = 6.8,   ph_sigma = 1.5,   k_clay = 20,   clay_ref = 25 )"},{"path":"https://eduaguilera.github.io/afsetools/reference/calc_nonsymbiotic_bnf.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Calculate Non-Symbiotic BNF — calc_nonsymbiotic_bnf","text":"x Data frame. Required columns: Area_ygpit_ha Harvested area hectares. Optional columns (absent, modifier = 1): N_synth_kgha Synthetic N fertilizer (kg N/ha). N_org_kgha Organic N inputs (kg N/ha). TMP Mean temperature (degrees C). WaterInput_mm Precipitation + irrigation (mm). precip_mm Precipitation (mm). irrig_mm Irrigation (mm). PET_mm Potential evapotranspiration (mm). SOM_pct Soil organic matter content (percent). soil_pH Soil pH. kgNha Crop-specific NSBNF base rate BNF table.       absent Name_biomass exists, joined automatically. nsbnf_default_kgha Numeric. Default NSBNF base rate crops without specific value BNF table (default 5 kg N/ha/yr). Based Cleveland et al. (1999) temperate agricultural soils. k_n_ns_synth Numeric. Rate constant N inhibition NSBNF synthetic N (default 0.005). Stronger symbiotic inhibition since free-living fixers avoid energy cost fixation mineral N available. k_n_ns_org Numeric. Rate constant N inhibition NSBNF organic N (default 0.0025). Weaker synthetic organic N mineralizes slowly. t_opt_ns Numeric. Optimal temperature non-symbiotic fixation (default 25). t_sigma_ns Numeric. Temperature Gaussian width (default 10). Broader symbiotic (8) diverse microbial communities provide thermal buffering. k_som Numeric. SOM half-saturation constant (default 2.0 percent). som_ref Numeric. Reference SOM normalization (default 2.5 percent). ph_opt Numeric. Optimal pH (default 6.8). ph_sigma Numeric. pH Gaussian width (default 1.5). k_clay Numeric. Half-saturation constant clay effect NSBNF (default 20 percent clay). clay_ref Numeric. Reference clay content normalization (default 25 percent, typical loam).","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/calc_nonsymbiotic_bnf.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Calculate Non-Symbiotic BNF — calc_nonsymbiotic_bnf","text":"Data frame added columns: NSBNF_base_kgha Base rate adjustment (kg N/ha). f_N_ns N inhibition factor. f_temp_ns Temperature factor. f_water_ns Water factor. f_SOM_ns SOM factor (normalized som_ref). f_pH_ns pH factor. f_clay_ns Clay texture factor (normalized       clay_ref). f_env_ns Combined environmental factor. NSBNF Non-symbiotic BNF Mg N.","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/calc_nonsymbiotic_bnf.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Calculate Non-Symbiotic BNF — calc_nonsymbiotic_bnf","text":"Estimates free-living associative BNF agricultural soils using crop-specific base rates environmental modifiers temperature, water availability, N inputs, soil organic matter, soil pH. **Base rates** literature: Rice paddies: 33 kg N/ha/yr (Ladha et al. 2016) -     cyanobacteria heterotrophic anaerobic fixation Sugarcane: 25 kg N/ha/yr (Urquiaga et al. 2012) -     endophytic fixation (Gluconacetobacter diazotrophicus) General cropland: 5 kg N/ha/yr default     (Cleveland et al. 1999) **N inhibition** (Dynarski & Houlton 2018): 100 kg N/ha, NSBNF reduces ~61 percent base. Free-living fixers avoid energy cost fixation mineral N available. **SOM effect** (Reed et al. 2011; Dynarski & Houlton 2018): Heterotrophic fixers require carbon energy source. Michaelis- Menten kinetics normalized typical agricultural SOM (2.5 percent). High-SOM soils show enhanced NSBNF. **pH effect** (Belnap 2002): Nitrogenase activity microbial communities sensitive soil pH. Gaussian around optimal 6.8 moderate decline acidic (pH < 5) alkaline (pH > 8) soils.","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/calc_nonsymbiotic_bnf.html","id":"references","dir":"Reference","previous_headings":"","what":"References","title":"Calculate Non-Symbiotic BNF — calc_nonsymbiotic_bnf","text":"Cleveland CC et al. (1999) Global Biogeochemical Cycles   13:623-645. Dynarski KA, Houlton BZ (2018) New Phytologist 217:68-85. Ladha JK et al. (2016) Scientific Reports 6:19355. Reed SC et al. (2011) Annual Review Ecology, Evolution,   Systematics 42:489-512. Urquiaga S et al. (2012) Plant Soil 356:5-21.","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/calc_nonsymbiotic_bnf.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Calculate Non-Symbiotic BNF — calc_nonsymbiotic_bnf","text":"","code":"if (FALSE) { # \\dontrun{ load_general_data()  # Basic: only area required, uses defaults df |> calc_nonsymbiotic_bnf()  # With environmental data: df |>   dplyr::mutate(     N_synth_kgha = 120, TMP = 22,     precip_mm = 700, PET_mm = 850,     SOM_pct = 3.2, soil_pH = 6.4   ) |>   calc_nonsymbiotic_bnf() } # }"},{"path":"https://eduaguilera.github.io/afsetools/reference/calc_weed_bnf.html","id":null,"dir":"Reference","previous_headings":"","what":"Calculate Weed and Cover Crop Symbiotic BNF — calc_weed_bnf","title":"Calculate Weed and Cover Crop Symbiotic BNF — calc_weed_bnf","text":"Weed BNF calculated : $$WeedsBNF = Weeds\\_NPP\\_MgN \\times Ndfa_{weeds} \\times   Leg\\_share_{weighted}$$ weighted legume share accounts spontaneous leguminous weeds deliberately seeded legume cover crops: $$Leg\\_share = Leg\\_spont \\times (1 - CC\\_share) +   Leg\\_seeded \\times CC\\_share$$ Environmental adjustments (N inhibition, temperature, water) applied weed Ndfa corresponding columns present (mechanism crop BNF).","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/calc_weed_bnf.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Calculate Weed and Cover Crop Symbiotic BNF — calc_weed_bnf","text":"","code":"calc_weed_bnf(x, k_n_synth = 0.0035, k_n_org = 0.0018, t_opt = 25, t_sigma = 8)"},{"path":"https://eduaguilera.github.io/afsetools/reference/calc_weed_bnf.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Calculate Weed and Cover Crop Symbiotic BNF — calc_weed_bnf","text":"x Data frame weed NPP data. Required columns: Weeds_NPP_MgN Weed NPP Mg N. LandUse Land use type (Cropland, Grassland, etc.). Legs_Seeded Legume fraction seeded cover crops       (0-1). Seeded_CC_share Share area seeded cover crops       (0-1). Optional environmental columns: see calc_crop_bnf. k_n_synth Numeric. Rate constant N inhibition synthetic N (default 0.0035). k_n_org Numeric. Rate constant N inhibition organic N (default 0.0018). t_opt Numeric. Optimal temperature (default 25). t_sigma Numeric. Temperature Gaussian width (default 8).","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/calc_weed_bnf.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Calculate Weed and Cover Crop Symbiotic BNF — calc_weed_bnf","text":"Data frame added columns: Weeds_Ndfa_ref Reference Ndfa weeds. Weeds_Ndfa Adjusted Ndfa weeds. Weeds_leg_share Weighted legume fraction. f_env_weed Environmental adjustment factor. WeedsBNF Weed BNF Mg N.","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/calc_weed_bnf.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Calculate Weed and Cover Crop Symbiotic BNF — calc_weed_bnf","text":"Estimates symbiotic BNF leguminous weeds seeded cover crops. legume fraction field vegetation weighted average spontaneous weeds seeded cover crops, based management data. Requires BNF object `load_general_data()` (reads \"Weeds\" row reference Ndfa spontaneous legume share). Cover crop seeded share applied cropland.","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/calc_weed_bnf.html","id":"references","dir":"Reference","previous_headings":"","what":"References","title":"Calculate Weed and Cover Crop Symbiotic BNF — calc_weed_bnf","text":"Peoples MB et al. (2009) Symbiosis 48:1-17.","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/calc_weed_bnf.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Calculate Weed and Cover Crop Symbiotic BNF — calc_weed_bnf","text":"","code":"if (FALSE) { # \\dontrun{ load_general_data() weed_data |> calc_weed_bnf() } # }"},{"path":"https://eduaguilera.github.io/afsetools/reference/calculate_crop_npp.html","id":null,"dir":"Reference","previous_headings":"","what":"Calculate Crop Net Primary Production Components — calculate_crop_npp","title":"Calculate Crop Net Primary Production Components — calculate_crop_npp","text":"function replaces enhances previous `calculate_crop_npp()` decomposing estimation specialized sub-functions use IPCC 2019 guidelines, literature-based coefficients, context-dependent adjustments irrigation, N input, variety era. calculation pipeline : 1. **Residues**: `calculate_crop_residues()` estimates -ground    residue biomass yield using IPCC linear model + ratio ensemble. 2. **Roots**: `calculate_crop_roots()` estimates -ground biomass    aerial biomass using IPCC RS ratios + reference values. 3. **Assembly**: Total crop NPP = Product + Residue + Root (DM).","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/calculate_crop_npp.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Calculate Crop Net Primary Production Components — calculate_crop_npp","text":"","code":"calculate_crop_npp(Dataset, w_ipcc = 0.5, w_ref = 0.5)"},{"path":"https://eduaguilera.github.io/afsetools/reference/calculate_crop_npp.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Calculate Crop Net Primary Production Components — calculate_crop_npp","text":"Dataset Data frame crop area production data. Required columns: Name_biomass Crop name matching Biomass_coefs. Prod_ygpit_Mg Production Mg fresh matter. Area_ygpit_ha Harvested area hectares. Year Production year (modern variety correction). region_HANPP Region name (modern variety correction). Water_regime \"Irrigated\", \"Rainfed\", \"Mixed\". N_input_kgha Nitrogen application rate (kg N/ha/yr). w_ipcc Numeric (0-1). Weight IPCC linear residue model residue estimation ensemble. Default 0.5. w_ref Numeric (0-1). Weight reference root biomass root estimation ensemble. Default 0.5.","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/calculate_crop_npp.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Calculate Crop Net Primary Production Components — calculate_crop_npp","text":"Data frame added columns: Prod_MgDM Product dry matter (Mg). Residue_MgDM -ground residue dry matter (Mg). Root_MgDM -ground root dry matter (Mg). Crop_NPP_MgDM Total crop NPP = Prod + Residue + Root (Mg DM). Yield_DM_Mgha Yield Mg DM per hectare. Intermediate coefficient columns Biomass_coefs dropped.","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/calculate_crop_npp.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Calculate Crop Net Primary Production Components — calculate_crop_npp","text":"Wrapper function calculates complete crop NPP calling `calculate_crop_residues()` -ground residue estimation `calculate_crop_roots()` -ground root estimation, assembles total crop NPP. **Backward compatibility**: function produces output columns previous `calculate_crop_npp()`. old function signature using `HI` parameter dynamic harvest index preserved via legacy alias `Calculate_crop_NPP()`. **Required context columns**: Dataset must include Year, region_HANPP, Water_regime, N_input_kgha columns. drive IPCC context-dependent adjustments modern variety era, irrigation regime, nitrogen input effects root allocation. Requires `load_general_data()`: - `Biomass_coefs` - `IPCC_residue_coefs`, `IPCC_root_coefs`, `IPCC_crop_mapping` - `Irrigation_adj`, `Modern_variety_adoption`, `N_input_RS_adj`","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/calculate_crop_npp.html","id":"references","dir":"Reference","previous_headings":"","what":"References","title":"Calculate Crop Net Primary Production Components — calculate_crop_npp","text":"IPCC (2019) 2019 Refinement 2006 IPCC Guidelines, Vol.4, Ch.11. Bolinder et al. (2007) Root biomass shoot root ratios. J Agric   Sci 145:127-137. Krausmann et al. (2013) Global human appropriation net primary   production. PNAS 110:10324-10329.","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/calculate_crop_npp.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Calculate Crop Net Primary Production Components — calculate_crop_npp","text":"","code":"if (FALSE) { # \\dontrun{ load_general_data()  # Dataset must include all required columns crop_npp <- crop_data |>   calculate_crop_npp(w_ipcc = 0.5, w_ref = 0.5) } # }"},{"path":"https://eduaguilera.github.io/afsetools/reference/calculate_crop_npp_components.html","id":null,"dir":"Reference","previous_headings":"","what":"Calculate Cropland NPP Components Including Weeds — calculate_crop_npp_components","title":"Calculate Cropland NPP Components Including Weeds — calculate_crop_npp_components","text":"Calculates complete cropland NPP including weed biomass, scaled potential NPP considering fallow periods.","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/calculate_crop_npp_components.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Calculate Cropland NPP Components Including Weeds — calculate_crop_npp_components","text":"","code":"calculate_crop_npp_components(Crop_NPPpot, .by = NULL)"},{"path":"https://eduaguilera.github.io/afsetools/reference/calculate_crop_npp_components.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Calculate Cropland NPP Components Including Weeds — calculate_crop_npp_components","text":"Crop_NPPpot data frame potential NPP values crop data .Character vector column names grouping operations (e.g., c(\"Year\", \"Region\")). Used scaling weeds calculations. NULL, grouping applied.","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/calculate_crop_npp_components.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Calculate Cropland NPP Components Including Weeds — calculate_crop_npp_components","text":"data frame complete cropland NPP components (crop + weeds) DM, C, N","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/calculate_crop_npp_components.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Calculate Cropland NPP Components Including Weeds — calculate_crop_npp_components","text":"","code":"if (FALSE) { # \\dontrun{ # With grouping by Year cropland_npp <- calculate_crop_npp_components(crop_npp_potential, .by = \"Year\")  # With multiple grouping variables cropland_npp <- calculate_crop_npp_components(crop_npp_potential,                                                  .by = c(\"Year\", \"Region\"))  # Without grouping cropland_npp <- calculate_crop_npp_components(crop_npp_potential, .by = NULL) } # }"},{"path":"https://eduaguilera.github.io/afsetools/reference/calculate_crop_residues.html","id":null,"dir":"Reference","previous_headings":"","what":"Calculate Crop Above-Ground Residue Biomass — calculate_crop_residues","title":"Calculate Crop Above-Ground Residue Biomass — calculate_crop_residues","text":"Three estimation methods combined: 1. **IPCC linear model** (IPCC 2019 Refinement, Vol.4, Ch.11, Table 11.1a):    `AG_residue_DM = Slope * Yield_DM + Intercept` 2. **Biomass_coefs ratio model** (package default):    `Residue_FM = Yield_FM * kg_residue_kg_product_FM` 3. **Modern variety adjustment** (Krausmann et al. 2013; Evenson & Gollin    2003): Historical correction pre-Green-Revolution varieties    lower harvest index (residue per unit product). final estimate weighted mean methods 1 2, irrigation variety-era adjustments applied.","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/calculate_crop_residues.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Calculate Crop Above-Ground Residue Biomass — calculate_crop_residues","text":"","code":"calculate_crop_residues(Dataset, w_ipcc = 0.5)"},{"path":"https://eduaguilera.github.io/afsetools/reference/calculate_crop_residues.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Calculate Crop Above-Ground Residue Biomass — calculate_crop_residues","text":"Dataset Data frame crop production data. Required columns: Name_biomass Crop name matching Biomass_coefs classification. Prod_ygpit_Mg Production Mg fresh matter. Area_ygpit_ha Harvested area hectares. Year Year production (modern variety adjustment). region_HANPP Region name matching Modern_variety_adoption. Water_regime One \"Irrigated\", \"Rainfed\", \"Mixed\". w_ipcc Numeric weight IPCC linear model ensemble (0-1). Default 0.5. Biomass_coefs ratio gets weight `1 - w_ipcc`.","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/calculate_crop_residues.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Calculate Crop Above-Ground Residue Biomass — calculate_crop_residues","text":"Data frame added columns: Prod_MgDM Product dry matter (Mg). Residue_MgDM Estimated -ground residue dry matter (Mg). Yield_DM_Mgha Yield Mg DM per hectare (intermediate).","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/calculate_crop_residues.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Calculate Crop Above-Ground Residue Biomass — calculate_crop_residues","text":"Estimates crop residue (straw, stover, etc.) dry matter yield data using ensemble IPCC 2019 linear models, Biomass_coefs ratios, context-dependent adjustments irrigation, N input, modern variety adoption. **IPCC linear model**: crop mapped via `IPCC_crop_mapping`, per-hectare residue estimated : `Residue_IPCC_Mgha = Slope_AG * Yield_DM_Mgha + Intercept_AG_MgDMha` captures empirical finding (Lassaletta et al. 2014) residue production purely proportional yield — base structural component (intercept). **Irrigation adjustment**: Irrigated crops typically higher harvest index (Sadras 2007), meaning less residue per unit product. adjustment factor (default 0.90 irrigated) `Irrigation_adj` table. **Modern variety correction**: Pre-Green-Revolution varieties lower harvest index. `Modern_variety_adoption` table provides regional time-series `HI_correction_factor` (>1.0 historical periods), multiplies residue:product ratio. **Ensemble**: final residue estimate blends methods: `Residue_MgDM = w_ipcc * IPCC_estimate + (1 - w_ipcc) * ratio_estimate` Requires objects `load_general_data()`: - `Biomass_coefs` (`Product_kgDM_kgFM`, `Residue_kgDM_kgFM`,   `kg_residue_kg_product_FM`) - `IPCC_residue_coefs`, `IPCC_crop_mapping` - `Irrigation_adj`, `Modern_variety_adoption`","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/calculate_crop_residues.html","id":"references","dir":"Reference","previous_headings":"","what":"References","title":"Calculate Crop Above-Ground Residue Biomass — calculate_crop_residues","text":"IPCC (2019) 2019 Refinement 2006 IPCC Guidelines National   Greenhouse Gas Inventories, Volume 4, Chapter 11, Table 11.1a. Krausmann et al. (2013) Global human appropriation net primary   production doubled 20th century. PNAS 110:10324-10329. Lassaletta et al. (2014) 50 year trends nitrogen use efficiency   world cropping systems. Biogeosciences 11:2889-2907. Sadras (2007) Evolutionary aspects trade-seed size   number crops. Field Crops Research 100:125-138.","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/calculate_crop_residues.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Calculate Crop Above-Ground Residue Biomass — calculate_crop_residues","text":"","code":"if (FALSE) { # \\dontrun{ load_general_data() crop_data |>   calculate_crop_residues(w_ipcc = 0.5) } # }"},{"path":"https://eduaguilera.github.io/afsetools/reference/calculate_crop_roots.html","id":null,"dir":"Reference","previous_headings":"","what":"Calculate Crop Below-Ground (Root) Biomass — calculate_crop_roots","title":"Calculate Crop Below-Ground (Root) Biomass — calculate_crop_roots","text":"Three estimation approaches combined: 1. **IPCC root:shoot ratio** (IPCC 2019 Refinement, Vol.4, Ch.11):    `Root_DM = Aerial_DM * RS_ratio`, RS_ratio adjusted    N input irrigation `IPCC_root_coefs` table. 2. **Reference root biomass** (Biomass_coefs `BG_Biomass_kgDM_ha`):    fixed per-hectare root biomass value, independent yield.    `Root_ref = BG_Biomass_kgDM_ha / 1000 * Area_ha` 3. **Biomass_coefs RS fallback**: IPCC coefficients    available, uses `Root_Shoot_ratio` Biomass_coefs. final estimate averages RS-based reference-based approaches, capped 3x default RS ratio prevent unrealistic values.","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/calculate_crop_roots.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Calculate Crop Below-Ground (Root) Biomass — calculate_crop_roots","text":"","code":"calculate_crop_roots(Dataset, w_ref = 0.5)"},{"path":"https://eduaguilera.github.io/afsetools/reference/calculate_crop_roots.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Calculate Crop Below-Ground (Root) Biomass — calculate_crop_roots","text":"Dataset Data frame -ground biomass already calculated. Required columns: Name_biomass Crop name matching Biomass_coefs. Prod_MgDM Product dry matter (Mg). Residue_MgDM Residue dry matter (Mg). Area_ygpit_ha Harvested area hectares. Water_regime \"Irrigated\", \"Rainfed\", \"Mixed\". N_input_kgha Nitrogen application rate (kg N/ha/yr). w_ref Numeric weight reference root biomass approach ensemble (0-1). Default 0.5. RS-based approach gets weight `1 - w_ref`.","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/calculate_crop_roots.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Calculate Crop Below-Ground (Root) Biomass — calculate_crop_roots","text":"Data frame added column: Root_MgDM Estimated -ground root dry matter (Mg).","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/calculate_crop_roots.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Calculate Crop Below-Ground (Root) Biomass — calculate_crop_roots","text":"Estimates root biomass dry matter -ground biomass using ensemble IPCC root:shoot ratios, reference root biomass values, adjustments N input irrigation regime. **N-input adjustment**: Higher nitrogen availability decreases root allocation due functional equilibrium (Poorter & Nagel 2000). `N_input_RS_adj` table classifies N rates 5 classes multiplicative RS factors (0.80 >200 kg N/ha 1.20 <20 kg N/ha). **Irrigation adjustment**: Irrigated crops develop shallower root systems (Benjamin et al. 2014). Factor `Irrigation_adj` table (default 0.85 irrigated). **RS selection priority**: IPCC_root_coefs > Biomass_coefs fallback. irrigation N-input columns present, IPCC table provides context-specific RS values; otherwise default `RS_default` used. **Ensemble cap**: Final root = weighted average RS-based reference-based estimates, capped 3x default RS ratio times aerial biomass. Requires `load_general_data()`: - `Biomass_coefs` (Root_Shoot_ratio, BG_Biomass_kgDM_ha) - `IPCC_root_coefs`, `IPCC_crop_mapping` - `N_input_RS_adj`, `Irrigation_adj`","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/calculate_crop_roots.html","id":"references","dir":"Reference","previous_headings":"","what":"References","title":"Calculate Crop Below-Ground (Root) Biomass — calculate_crop_roots","text":"IPCC (2019) 2019 Refinement 2006 IPCC Guidelines National   Greenhouse Gas Inventories, Volume 4, Chapter 11. Bolinder, M.. et al. (2007) Root biomass shoot root ratios   related ground biomass. J Agric Sci 145:127-137. Poorter, H. & Nagel, O. (2000) role biomass allocation   growth response plants different levels light, CO2, nutrients   water. New Phytologist 147:135-147. Benjamin, J.G. et al. (2014) Water deficit effects root distribution   soybean, field pea chickpea. Agronomy Journal 106:2033-2040.","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/calculate_crop_roots.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Calculate Crop Below-Ground (Root) Biomass — calculate_crop_roots","text":"","code":"if (FALSE) { # \\dontrun{ load_general_data() crop_data |>   calculate_crop_residues() |>   calculate_crop_roots(w_ref = 0.5) } # }"},{"path":"https://eduaguilera.github.io/afsetools/reference/calculate_footprints.html","id":null,"dir":"Reference","previous_headings":"","what":"Calculate Complete Environmental Footprints Along Supply Chains — calculate_footprints","title":"Calculate Complete Environmental Footprints Along Supply Chains — calculate_footprints","text":"Main workflow function traces environmental footprints global supply chains, primary production processing, feed, final products. function orchestrates entire footprint calculation process returns intermediate final footprint data frames.","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/calculate_footprints.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Calculate Complete Environmental Footprints Along Supply Chains — calculate_footprints","text":"","code":"calculate_footprints(dtm = NULL)"},{"path":"https://eduaguilera.github.io/afsetools/reference/calculate_footprints.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Calculate Complete Environmental Footprints Along Supply Chains — calculate_footprints","text":"dtm Optional detailed trade matrix. `NULL` (default), function uses gross-trade mode (`calc_avail_fp_gt()`). provided, automatically uses detailed bilateral trade mode (`calc_avail_fp_dtm()`). Required columns provided: `Year`, `area_code`, `area_code_p`, `area_p`, `item_code_cbs`, `Element`, `Country_share` (`Element == \"Import\"` rows used). `Impact` generated internally expanding `dtm` rows across impacts present `Impact_prod` year.","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/calculate_footprints.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Calculate Complete Environmental Footprints Along Supply Chains — calculate_footprints","text":"named list intermediate final footprint tables, including:   `FP_prim`, `FP_prim_i`, `FP_prim_i_global`, `FP_prim_ds`, `FP_prim_ds_i`,   `FP_processed_raw`, `FP_processed_raw_i`, `FP_processed_ds`,   `FP_processed_ds_i`, `FP_reprocessed_raw`, `FP_reprocessed_raw_i`,   `FP_raw_all`, `FP_feed_raw`, `FP_feed`, `FP_feed_i`, `FP_feed_ds`,   `FP_feed_ds_i`, `FP_ioc`, `FP_i`, `FP_final`, `Seed_share`,   `draught_shares`, `Import_share`, `Processing_shares`.","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/calculate_footprints.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Calculate Complete Environmental Footprints Along Supply Chains — calculate_footprints","text":"function implements complete footprint accounting system : Calculates seed shares removes production Allocates impacts co-products using economic allocation Traces impacts processing chains Accounts international trade (gross trade `dtm` `NULL`,     bilateral trade matrix `dtm` provided) Handles feed products livestock production Allocates draught animal services crop production `calculate_footprints()` takes `dtm` explicitly. required inputs read implicitly objects calling environment. Required workflow objects (created outside `load_general_data()`): `CBS` Commodity balance table. Columns used: `Year`, `area`,   `area_code`, `item_cbs`, `item_code_cbs`, `Element`, `Value`. `Primary_all` Primary production / co-product table. Columns used:   `Year`, `area`, `area_code`, `item_prod`, `item_code_prod`, `unit`,   `Value`, `item_cbs`, `item_code_cbs`, `Live_anim`, `Live_anim_code`. `Impact_prod` Production impact table. Columns used: `Year`, `area`,   `item_code_prod`, `Impact`, `Value`, `u_FU` (optionally `item_prod`). `Crop_NPPr_NoFallow` Crop NPP / residue table. Columns used:   `Year`, `area`, `item_prod`, `item_cbs`, `Product_residue`,   `Prod_ygpit_Mg`. `Feed_intake` Feed intake table. Columns used: `Year`, `area`,   `Live_anim`, `item_cbs`, `item_code_cbs`, `Supply`, `Intake_DM`.   `area_code` recovered footprint tables feed join. `Primary_prices` Primary product prices. Columns used: `Year`,   `item_code_prod`, `Price`. `CBS_item_prices` CBS item prices. Columns used: `Year`, `Element`,   `item_cbs`, `item_code_cbs`, `Price`. `Processing_coefs` Processing conversion coefficients. Columns used:   `Year`, `area_code`, `item_code_cbs`, `item_cbs`, `cf`. `Relative_residue_price` Numeric scalar used value residues   relative product prices. Required auxiliary objects loaded `load_general_data()`: `items_full` (sheet `items_full` `Codes_coefs.xlsx`) Columns used:   `item_cbs`, `item_code_cbs`, `group`. `items_prod_full` (sheet `items_prod_full` `Codes_coefs.xlsx`) Columns used: `item_prod`, `item_code_prod`, `Name_biomass`. `Animals_codes` (sheet `Animals_codes` `Codes_coefs.xlsx`) Columns used: `item_cbs`, `item_code_cbs`. `Primary_double` (sheet `Primary_double` `Codes_coefs.xlsx`) Columns used (via `Prepare_prim()`): `Item_area`, `item_prod`,   `item_code_prod`, `Multi_type`. `Biomass_coefs` (`Biomass_coefs.xlsx`) Columns used:   `Name_biomass`, `Product_kgDM_kgFM`, `Product_kgN_kgDM`.","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/calculate_footprints.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Calculate Complete Environmental Footprints Along Supply Chains — calculate_footprints","text":"","code":"if (FALSE) { # \\dontrun{ library(afsetools) load_general_data()  # Requires workflow objects in the environment: # CBS, Primary_all, Impact_prod, Crop_NPPr_NoFallow, Feed_intake, # Primary_prices, CBS_item_prices, Processing_coefs, Relative_residue_price  # Calculate footprints using gross trade (omit dtm) footprints <- calculate_footprints()  # To use bilateral trade, pass dtm = my_dtm_data (or dtm = DTM)  # Access individual footprint tables fp_primary <- footprints$FP_prim fp_final <- footprints$FP_final } # }"},{"path":"https://eduaguilera.github.io/afsetools/reference/calculate_land_scaling.html","id":null,"dir":"Reference","previous_headings":"","what":"Calculate Land Scaling Factors — calculate_land_scaling","title":"Calculate Land Scaling Factors — calculate_land_scaling","text":"Calculates scaling factors account cropping intensity (fallow, double cropping, etc.).","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/calculate_land_scaling.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Calculate Land Scaling Factors — calculate_land_scaling","text":"","code":"calculate_land_scaling()"},{"path":"https://eduaguilera.github.io/afsetools/reference/calculate_land_scaling.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Calculate Land Scaling Factors — calculate_land_scaling","text":"data frame columns: Year, area, Herb_Woody, land_scaling","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/calculate_land_scaling.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Calculate Land Scaling Factors — calculate_land_scaling","text":"","code":"if (FALSE) { # \\dontrun{ scaling_factors <- calculate_land_scaling() } # }"},{"path":"https://eduaguilera.github.io/afsetools/reference/calculate_npp_dm_c_n.html","id":null,"dir":"Reference","previous_headings":"","what":"Calculate NPP in Dry Matter, Carbon, and Nitrogen — calculate_npp_dm_c_n","title":"Calculate NPP in Dry Matter, Carbon, and Nitrogen — calculate_npp_dm_c_n","text":"Converts NPP components dry matter, carbon, nitrogen units, including crop weed biomass.","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/calculate_npp_dm_c_n.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Calculate NPP in Dry Matter, Carbon, and Nitrogen — calculate_npp_dm_c_n","text":"","code":"calculate_npp_dm_c_n(AreaNPP)"},{"path":"https://eduaguilera.github.io/afsetools/reference/calculate_npp_dm_c_n.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Calculate NPP in Dry Matter, Carbon, and Nitrogen — calculate_npp_dm_c_n","text":"AreaNPP data frame NPP components biomass coefficients","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/calculate_npp_dm_c_n.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Calculate NPP in Dry Matter, Carbon, and Nitrogen — calculate_npp_dm_c_n","text":"data frame NPP expressed DM, C, N components","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/calculate_npp_dm_c_n.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Calculate NPP in Dry Matter, Carbon, and Nitrogen — calculate_npp_dm_c_n","text":"","code":"if (FALSE) { # \\dontrun{ npp_nutrients <- calculate_npp_dm_c_n(area_npp_data) } # }"},{"path":"https://eduaguilera.github.io/afsetools/reference/calculate_potential_npp.html","id":null,"dir":"Reference","previous_headings":"","what":"Calculate Potential Net Primary Production (NPP) — calculate_potential_npp","title":"Calculate Potential Net Primary Production (NPP) — calculate_potential_npp","text":"Calculates potential NPP using various models including Miami, NCEAS, Rosenzweig. function estimates ecosystem productivity based temperature precipitation.","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/calculate_potential_npp.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Calculate Potential Net Primary Production (NPP) — calculate_potential_npp","text":"","code":"calculate_potential_npp(Dataset)"},{"path":"https://eduaguilera.github.io/afsetools/reference/calculate_potential_npp.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Calculate Potential Net Primary Production (NPP) — calculate_potential_npp","text":"Dataset data frame containing climate data columns: TMP (temperature), Water_input_mm (Precipitation + Irrigation), AET_mm (actual evapotranspiration)","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/calculate_potential_npp.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Calculate Potential Net Primary Production (NPP) — calculate_potential_npp","text":"data frame calculated NPP values different models MgDM/ha","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/calculate_potential_npp.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Calculate Potential Net Primary Production (NPP) — calculate_potential_npp","text":"","code":"if (FALSE) { # \\dontrun{ climate_data <- data.frame(TMP = 15, WaterInput_mm = 800, AET_mm = 700) npp_results <- calculate_potential_npp(climate_data) } # }"},{"path":"https://eduaguilera.github.io/afsetools/reference/drop_cols.html","id":null,"dir":"Reference","previous_headings":"","what":"Drop columns from data frame — drop_cols","title":"Drop columns from data frame — drop_cols","text":"Drops undefined number columns data frame. Silently ignores columns exist data frame.","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/drop_cols.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Drop columns from data frame — drop_cols","text":"","code":"drop_cols(df, ...)"},{"path":"https://eduaguilera.github.io/afsetools/reference/drop_cols.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Drop columns from data frame — drop_cols","text":"df Data frame ... Column names drop (character strings character vector)","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/drop_cols.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Drop columns from data frame — drop_cols","text":"Data frame without specified columns","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/drop_cols.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Drop columns from data frame — drop_cols","text":"","code":"df <- data.frame(a = 1:3, b = 4:6, c = 7:9) drop_cols(df, \"a\", \"b\") #>   c #> 1 7 #> 2 8 #> 3 9 drop_cols(df, c(\"a\", \"nonexistent\"))   #>   b c #> 1 4 7 #> 2 5 8 #> 3 6 9"},{"path":"https://eduaguilera.github.io/afsetools/reference/extract_luh2.html","id":null,"dir":"Reference","previous_headings":"","what":"Extract Data from Land-Use Harmonization 2 (LUH2) Dataset — extract_luh2","title":"Extract Data from Land-Use Harmonization 2 (LUH2) Dataset — extract_luh2","text":"Extracts carbon stock area data Land Use Harmonization 2 (LUH2) dataset v2h. Processes land use states, carbon densities, harvest data netCDF files aggregates specified regions.","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/extract_luh2.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Extract Data from Land-Use Harmonization 2 (LUH2) Dataset — extract_luh2","text":"","code":"extract_luh2(L_files_path, RegionNames, studied_period)"},{"path":"https://eduaguilera.github.io/afsetools/reference/extract_luh2.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Extract Data from Land-Use Harmonization 2 (LUH2) Dataset — extract_luh2","text":"L_files_path Character string path LUH2 data files directory RegionNames Spatial object (sf) region polygons extraction studied_period Numeric vector years extract (e.g., 1700:2022)","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/extract_luh2.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Extract Data from Land-Use Harmonization 2 (LUH2) Dataset — extract_luh2","text":"Data frame Stock_area columns:   - Region_name: Region identifier   - Year: Year   - Land_Use: Specific land use category (Primary_forested, Secondary_nonforested, etc.)   - LandUse: Aggregated land use (Forest, Grassland_schrubland, Pasture, Cropland, Urban)   - Disturbance: Disturbance level (Primary, Secondary, Managed_pasture, Rangeland, Cropland, Urban)   - Area_Mha: Area million hectares   - C_stock_Tg: Carbon stock teragrams   - C_density_Mg_ha: Carbon density megagrams per hectare","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/extract_luh2.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Extract Data from Land-Use Harmonization 2 (LUH2) Dataset — extract_luh2","text":"function processes following LUH2 layers: - Primary forested non-forested lands - Secondary forested non-forested lands - Managed pasture rangeland - Cropland (C3 annual, C3 perennial, C4 annual, C4 perennial, C3 N-fixing) - Urban areas Carbon stocks calculated using: - Potential carbon density (ptbio) primary lands - Secondary biomass carbon density (secmb) secondary lands","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/extract_luh2.html","id":"references","dir":"Reference","previous_headings":"","what":"References","title":"Extract Data from Land-Use Harmonization 2 (LUH2) Dataset — extract_luh2","text":"Hurtt, G. C. et al. (2011) doi:10.1007/s10584-011-0153-2 https://luh.umd.edu/data.shtml LUH2 v2h data: http://gsweb1vh2.umd.edu/LUH2/LUH2_v2h/","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/extract_luh2.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Extract Data from Land-Use Harmonization 2 (LUH2) Dataset — extract_luh2","text":"","code":"if (FALSE) { # \\dontrun{ library(sf) library(raster)  # Load region polygons regions <- st_read(\"path/to/regions.shp\")  # Extract LUH2 data for 1900-2020 stock_area <- extract_luh2(   L_files_path = \"path/to/LUH2/\",   RegionNames = regions,   studied_period = 1900:2020 ) } # }"},{"path":"https://eduaguilera.github.io/afsetools/reference/filter_areas.html","id":null,"dir":"Reference","previous_headings":"","what":"Filter and Aggregate Areas by Polity — filter_areas","title":"Filter and Aggregate Areas by Polity — filter_areas","text":"Harmonizes country-level data joining regions_full polity codes aggregating values polity groupings. Used internally map FAO area codes standardized polity areas.","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/filter_areas.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Filter and Aggregate Areas by Polity — filter_areas","text":"","code":"filter_areas(df, ...)"},{"path":"https://eduaguilera.github.io/afsetools/reference/filter_areas.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Filter and Aggregate Areas by Polity — filter_areas","text":"df Data frame area_code column columns Year, unit, Element, Value ... Additional columns include grouping (bare column names)","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/filter_areas.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Filter and Aggregate Areas by Polity — filter_areas","text":"Data frame aggregated polity renamed area/area_code columns","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/filter_areas.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Filter and Aggregate Areas by Polity — filter_areas","text":"Requires regions_full object load_general_data() columns: code, polity_code, polity_name.","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/get_global_export_footprint.html","id":null,"dir":"Reference","previous_headings":"","what":"Get Global Average Export Footprint — get_global_export_footprint","title":"Get Global Average Export Footprint — get_global_export_footprint","text":"Calculates global average footprint exported products, weighted export shares.","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/get_global_export_footprint.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Get Global Average Export Footprint — get_global_export_footprint","text":"","code":"get_global_export_footprint(df, cbs)"},{"path":"https://eduaguilera.github.io/afsetools/reference/get_global_export_footprint.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Get Global Average Export Footprint — get_global_export_footprint","text":"df data frame product footprints cbs Commodity balance sheet data used calculate export shares","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/get_global_export_footprint.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Get Global Average Export Footprint — get_global_export_footprint","text":"data frame global average footprints (u_ton_glob)","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/get_global_export_footprint.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Get Global Average Export Footprint — get_global_export_footprint","text":"","code":"if (FALSE) { # \\dontrun{ global_footprint <- get_global_export_footprint(product_footprints, cbs) } # }"},{"path":"https://eduaguilera.github.io/afsetools/reference/get_herbwoody_fao.html","id":null,"dir":"Reference","previous_headings":"","what":"Get Herbaceous and Woody Land from FAO — get_herbwoody_fao","title":"Get Herbaceous and Woody Land from FAO — get_herbwoody_fao","text":"Extracts herbaceous (arable) woody (permanent crops) land area FAO land use data.","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/get_herbwoody_fao.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Get Herbaceous and Woody Land from FAO — get_herbwoody_fao","text":"","code":"get_herbwoody_fao()"},{"path":"https://eduaguilera.github.io/afsetools/reference/get_herbwoody_fao.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Get Herbaceous and Woody Land from FAO — get_herbwoody_fao","text":"data frame columns: Year, area, Herb_Woody, Land_tot","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/get_herbwoody_fao.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Get Herbaceous and Woody Land from FAO — get_herbwoody_fao","text":"","code":"if (FALSE) { # \\dontrun{ land_data <- get_herbwoody_fao() } # }"},{"path":"https://eduaguilera.github.io/afsetools/reference/ggplotRegression.html","id":null,"dir":"Reference","previous_headings":"","what":"Plot Linear Regression with Statistics — ggplotRegression","title":"Plot Linear Regression with Statistics — ggplotRegression","text":"Creates scatter plot linear regression line displays model statistics (R², intercept, slope, p-value) title.","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/ggplotRegression.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Plot Linear Regression with Statistics — ggplotRegression","text":"","code":"ggplotRegression(fit)"},{"path":"https://eduaguilera.github.io/afsetools/reference/ggplotRegression.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Plot Linear Regression with Statistics — ggplotRegression","text":"fit linear model object created lm()","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/ggplotRegression.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Plot Linear Regression with Statistics — ggplotRegression","text":"ggplot2 plot object","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/ggplotRegression.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Plot Linear Regression with Statistics — ggplotRegression","text":"","code":"if (FALSE) { # \\dontrun{ model <- lm(mpg ~ wt, data = mtcars) ggplotRegression(model) } # }"},{"path":"https://eduaguilera.github.io/afsetools/reference/grapes-not-in-grapes.html","id":null,"dir":"Reference","previous_headings":"","what":"Exclude operator — %!in%","title":"Exclude operator — %!in%","text":"Negation `","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/grapes-not-in-grapes.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Exclude operator — %!in%","text":"","code":"x %!in% y"},{"path":"https://eduaguilera.github.io/afsetools/reference/grapes-not-in-grapes.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Exclude operator — %!in%","text":"x Vector NULL: values matched y Vector NULL: values matched ","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/grapes-not-in-grapes.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Exclude operator — %!in%","text":"logical vector indicating match element x","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/grapes-not-in-grapes.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Exclude operator — %!in%","text":"","code":"c(1, 2, 3) %!in% c(2, 4, 6) # Returns TRUE FALSE TRUE #> [1]  TRUE FALSE  TRUE"},{"path":"https://eduaguilera.github.io/afsetools/reference/integrate_fallow.html","id":null,"dir":"Reference","previous_headings":"","what":"Integrate Fallow Area into Cropland Area — integrate_fallow","title":"Integrate Fallow Area into Cropland Area — integrate_fallow","text":"Integrates area fallow land area crops distributing fallow area proportionally across herbaceous crops based area share.","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/integrate_fallow.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Integrate Fallow Area into Cropland Area — integrate_fallow","text":"","code":"integrate_fallow(x, .by = NULL)"},{"path":"https://eduaguilera.github.io/afsetools/reference/integrate_fallow.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Integrate Fallow Area into Cropland Area — integrate_fallow","text":"x Data frame cropland fallow area data containing columns: LandUse, Name_biomass, Area_ygpit_ha .Character vector column names area aggregation grouping (e.g., c(\"Year\", \"Region\")). NULL, grouping applied.","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/integrate_fallow.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Integrate Fallow Area into Cropland Area — integrate_fallow","text":"Data frame fallow area integrated crop areas, excluding   separate fallow entries. Includes Variable = \"AreaProd\" Cat_1   classification.","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/integrate_fallow.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Integrate Fallow Area into Cropland Area — integrate_fallow","text":"function: 1. Filters non-cropland fallow entries 2. Identifies herbaceous crops using Names_biomass Names_cats 3. Calculates area share herbaceous crop within groups 4. Distributes fallow area proportionally herbaceous crops 5. Adds Cat_1 classification Names_cats Requires objects load_general_data(): - Names_biomass (Name_biomass, Name, Herb_Woody columns) - Names_cats (Name, Cat_1 columns) Used Crop_AreaNPP.R Scenarios.R workflows.","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/integrate_fallow.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Integrate Fallow Area into Cropland Area — integrate_fallow","text":"","code":"if (FALSE) { # \\dontrun{ cropland_data |>   integrate_fallow(.by = c(\"Year\", \"Region\", \"Item\")) } # }"},{"path":"https://eduaguilera.github.io/afsetools/reference/is_empty.html","id":null,"dir":"Reference","previous_headings":"","what":"Check if dataset is empty — is_empty","title":"Check if dataset is empty — is_empty","text":"Checks data frame rows","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/is_empty.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Check if dataset is empty — is_empty","text":"","code":"is_empty(df)"},{"path":"https://eduaguilera.github.io/afsetools/reference/is_empty.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Check if dataset is empty — is_empty","text":"df Data frame check","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/is_empty.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Check if dataset is empty — is_empty","text":"Logical indicating data frame zero rows","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/items_full.html","id":null,"dir":"Reference","previous_headings":"","what":"Item Classifications — items_full","title":"Item Classifications — items_full","text":"Harmonized nomenclature food agricultural items codes, names, category classifications.","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/items_full.html","id":"format","dir":"Reference","previous_headings":"","what":"Format","title":"Item Classifications — items_full","text":"data frame item information: item_code Standardized item code item_name Item name category Product category group Product group","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/items_full.html","id":"source","dir":"Reference","previous_headings":"","what":"Source","title":"Item Classifications — items_full","text":"FAO international databases","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/load_general_data.html","id":null,"dir":"Reference","previous_headings":"","what":"Load General Data, Codes, Coefficients, and Vectors — load_general_data","title":"Load General Data, Codes, Coefficients, and Vectors — load_general_data","text":"Loads foundational data objects Excel files inst/extdata/ optionally creates color palettes, factor levels, categorical dataframes via `load_vectors()`. function creates 73+ objects (370+ vectors) calling environment including: - 35 code/nomenclature objects Codes_coefs.xlsx - 3 derived objects (regions_full_uISO3, Names_biomass_cats, items_prim) - 17 biomass coefficient objects Biomass_coefs.xlsx - 6 IPCC residue/root coefficient objects Biomass_coefs.xlsx - 7 GWP objects GWP.xlsx - 3 BNF objects BNF.xlsx - 6 miscellaneous coefficient scalars - 300+ vectors dataframes `load_vectors()` (load_vectors = TRUE) vectors created directly using `load_vectors()`, ensuring available installed package development mode.","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/load_general_data.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Load General Data, Codes, Coefficients, and Vectors — load_general_data","text":"","code":"load_general_data(path = NULL, load_vectors = TRUE)"},{"path":"https://eduaguilera.github.io/afsetools/reference/load_general_data.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Load General Data, Codes, Coefficients, and Vectors — load_general_data","text":"path Optional character string path data directory. NULL (default), uses system.file(\"extdata\", package = \"afsetools\") load_vectors Logical. TRUE (default), calls `load_vectors()` create color palettes factor levels. Set FALSE load data files.","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/load_general_data.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Load General Data, Codes, Coefficients, and Vectors — load_general_data","text":"NULL (loads objects parent environment)","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/load_general_data.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Load General Data, Codes, Coefficients, and Vectors — load_general_data","text":"Objects loaded Codes_coefs.xlsx: regions_full, region_krausmann, polities_whep, polities_cats, regions_fabio, Animals_codes, Names_Liv_Prod, CBS_Trade_codes, CB_processing, items_prod_full, CB_processing_tidy, items_full, Names_biomass_CB, Names_cats, Cats, Primary_double, items_proc_fabio, Feedstuff_FEDNA, FishStat_items, Prov, Names_Prov, FAO_Sp, Crops_Eurostat, Names_MAPA, Names_Lab, CB_item, Names_biomass, Biomass_names, Crop_Names, conv_bouwman, conv_krausmann, HI_changes_krausmann, residue_krausmann, Liv_LU_coefs, CBS_cat Derived objects: regions_full_uISO3, Names_biomass_cats, items_prim Biomass coefficient objects: Biomass_coefs, Nutrients_energy, Root_Shoot_ratio_W, Residue_kgDM_kgFM_W, Residue_kgN_kgDM_W, Root_kgN_kgDM_W, Residue_kgC_kgDM_W, Root_kgC_kgDM_W, Rhizod_kgN_kgRootN_W, Residue_kgC_kgDM_Wo, Root_kgC_kgDM_Wo IPCC residue/root coefficient objects: IPCC_residue_coefs, IPCC_root_coefs, IPCC_crop_mapping, Modern_variety_adoption, N_input_RS_adj, Irrigation_adj GWP objects: GWP, GWP_C, GWP_CO2, GWP_CH4, GWP_CH4_fossil, GWP_N2ON, GWP_N2O BNF objects: Names_BNF, BNF, Pure_legs Miscellaneous coefficients: toe, IOM, SOM_C, Soil_depth_carbon, Protein_N, Kcal_MJ Vectors dataframes created `load_vectors()` (load_vectors = TRUE): Month-related: Month_names, Month_order, Month_integer, Month_number, Month_numbers Color palettes: Total_color, SOM_color, numerous category-specific colors Factor levels: Irrig_Climate_levels, PlantType_levels, GHG_levels, Cat_1_levels, many others data visualization Named color vectors: ggplot2 scale functions (e.g., Irrig_Climate_colours, NPP_colours, Cat_01_colours) Categorical dataframes: NPP_cat, C_input_cat categorization","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/load_general_data.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Load General Data, Codes, Coefficients, and Vectors — load_general_data","text":"","code":"if (FALSE) { # \\dontrun{ # Load all data and vectors into current environment load_general_data()  # Load only data files, skip vectors load_general_data(load_vectors = FALSE)  # Check what was loaded ls() } # }"},{"path":"https://eduaguilera.github.io/afsetools/reference/load_vectors.html","id":null,"dir":"Reference","previous_headings":"","what":"Load Color Palettes, Factor Levels, and Categorical Vectors — load_vectors","title":"Load Color Palettes, Factor Levels, and Categorical Vectors — load_vectors","text":"Creates 300+ vector objects calling environment data visualization analysis, including: - Month-related vectors dataframes - Color palettes different categories - Factor level orderings - Named color vectors ggplot2 scale functions - Categorical dataframes NPP C input categorization function called internally `load_general_data()` `load_vectors = TRUE`.","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/load_vectors.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Load Color Palettes, Factor Levels, and Categorical Vectors — load_vectors","text":"","code":"load_vectors(env = parent.frame())"},{"path":"https://eduaguilera.github.io/afsetools/reference/load_vectors.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Load Color Palettes, Factor Levels, and Categorical Vectors — load_vectors","text":"env Environment load vectors . Defaults parent.frame().","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/load_vectors.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Load Color Palettes, Factor Levels, and Categorical Vectors — load_vectors","text":"NULL (loads objects specified environment)","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/load_vectors.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Load Color Palettes, Factor Levels, and Categorical Vectors — load_vectors","text":"vectors created using assign() ensure available specified environment without needing source external files.","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/load_vectors.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Load Color Palettes, Factor Levels, and Categorical Vectors — load_vectors","text":"","code":"if (FALSE) { # \\dontrun{ # Load vectors into current environment load_vectors()  # Check what was loaded ls() } # }"},{"path":"https://eduaguilera.github.io/afsetools/reference/redistribute_feed.html","id":null,"dir":"Reference","previous_headings":"","what":"Redistribute available supply among Livestock_cat based on their demand — redistribute_feed","title":"Redistribute available supply among Livestock_cat based on their demand — redistribute_feed","text":"`redistribute_feed()` matches livestock feed demand available feed items hierarchical allocation follows remaining-share principle avoid exceeding availability.redistribution path adapts `fixed_demand` column demand table. `fixed_demand = TRUE` uses six-level hierarchy guarantees demand Livestock_cat-Province_name-Year group met (resorting provincial grassland), `fixed_demand = FALSE` uses five-level hierarchy honours observed availability can exceed original demand supply abundant. modes operate year following hierarchy levels order: * **Fixed demand (`fixed_demand = TRUE`)** – six levels:   1. Item-level matches (provincial national)   2. Substitution within `Cat_1` (prov. national)   3. Substitution within `Cat_feed` (prov. national)   4. Inter-provincial trade Provincial items, excluding      `Cat_feed == \"Grass\"`   5. Substitution within remaining non-grassland      availability (provincial national)   6. Fulfil residual demand unlimited provincial      grassland * **Availability-driven (`fixed_demand = FALSE`)** – five   levels:   1. Item-level matches (provincial national)   2. Substitution within `Cat_1` (prov. national)   3. Substitution within `Cat_feed` (prov. national)   4. Substitution within remaining non-grassland      availability (provincial national)   5. Distribute surplus availability `item_cbs`      across Year-Province-Livestock demand combinations      proportionally demand, respecting      provincial national nature item. Intake can      exceed original demand stage. function relies environment objects `items_full`, `Cats`, optionally `Monogastric` (character vector monogastric livestock categories). Call `load_general_data()` using function.","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/redistribute_feed.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Redistribute available supply among Livestock_cat based on their demand — redistribute_feed","text":"","code":"redistribute_feed(   Feed_demand,   Feed_avail,   zoot_fixed_max_multiplier = 3,   territory_col = \"Territory\",   sub_territory_col = \"Sub_territory\",   verbose = TRUE )"},{"path":"https://eduaguilera.github.io/afsetools/reference/redistribute_feed.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Redistribute available supply among Livestock_cat based on their demand — redistribute_feed","text":"Feed_demand data frame columns `Year`, `Livestock_cat`, `item_cbs`, `Cat_1`, `Cat_feed`, `demand_MgDM`, `fixed_demand` (logical), plus user-selected territory columns indicated `territory_col` `sub_territory_col`. `fixed_demand` column controls redistribution mode row-wise demand record, allowing mixed fixed availability-driven livestock categories within `Year x Territory` combination. Feed_avail data frame columns `Year`, `item_cbs`, `Cat_1`, `Cat_feed`, `Avail_MgDM`, plus user-selected territory columns indicated `territory_col` `sub_territory_col`. `Feed_scale` inferred function `sub_territory_col` (`\"Provincial\"` present, `\"National\"` otherwise). table must pre-aggregated item level. zoot_fixed_max_multiplier Numeric multiplier (default 3) controlling maximum ratio intake availability Zoot_fixed items. availability Zoot_fixed zero NA, cap applied intake equals demand. territory_col Character scalar indicating broad territory column name shared `Feed_demand` `Feed_avail`. Redistribution boundaries defined `Year x territory_col`. sub_territory_col Character scalar indicating local territory column name shared `Feed_demand` `Feed_avail` (e.g., provinces). verbose Logical (default `TRUE`). `TRUE`, prints stage--stage diagnostic messages. Set `FALSE` silent operation.","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/redistribute_feed.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Redistribute available supply among Livestock_cat based on their demand — redistribute_feed","text":"tibble columns `Year`, column named   `territory_col`, column named   `sub_territory_col`, `Livestock_cat`, `item_cbs`,   `Cat_1`, `Cat_feed`, `demand_MgDM`, `intake_MgDM`,   `scaling_factor`, `hierarchy_level`,   `original_demand_item`, `original_Province`,   `fixed_demand`. `item_cbs` shows actual item consumed (  availability), `original_demand_item` shows   originally requested. substitution occurs,   differ. `original_Province` shows province feed   came (NA national items). `Cat_1` appended   end using lookup table `items_full`,   `Cat_feed` using lookup table `Cats`. `hierarchy_level` values depend redistribution   mode: * Fixed demand (`TRUE`):     1. `\"1_item_exact\"`     2. `\"2_Cat_1_sub\"`     3. `\"3_Cat_feed_sub\"`     4. `\"4_inter_prov_trade\"`     5. `\"5_all_substitute\"`     6. `\"6_grassland_unlimited\"` * Availability-driven (`FALSE`):     1. `\"1_item_exact\"`     2. `\"2_Cat_1_sub\"`     3. `\"3_Cat_feed_sub\"`     4. `\"4_all_substitute\"`     5. `\"5_surplus_distribution\"` modes present demand records   run, function executes mixed workflow: fixed   rows can reach `\"6_grassland_unlimited\"`, variable   groups receive surplus allocation.","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/redistribute_feed.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Redistribute available supply among Livestock_cat based on their demand — redistribute_feed","text":"allocation follows rules: 1. Items `Cat_feed == \"Zoot_fixed\"` kept unchanged    (intake equals demand, even availability lower),    capped    `zoot_fixed_max_multiplier * availability` prevent    extreme violations. availability zero NA,    cap applied. cap applied, excess demand    met available items following    hierarchy. 2. Monogastric categories allocated first.    `Monogastric` vector present environment    defining Livestock_cat monogastric. 3. Items without defined `feedtype_graniv` ignored    monogastrics. `feedtype_graniv` joined    `items_full` lookup table. 4. Ruminant Livestock_cat categories processed    remaining availability. 5. availability item_cbs redistributed    based demand, respecting hierarchy levels    provincial/national nature item. 6. levels 1-3, must ensured ,    availability given feed category higher    demand, demand satisfied    moving next level. 7. overall redistribution level 5    (`fixed_demand=TRUE`) 4 (`fixed_demand=FALSE`),    available items prioritized according    `catfeed_priority` (Lactation, High_quality,    Low_quality, Residues, Grass). result    available high-priority feedstuff allocated    lower-priority items considered. `original_demand_item` always records item requested input demand, even intake met different item substitution. resulting `scaling_factor` computed per demand row `sum(intake_MgDM) / demand_MgDM`.","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/redistribute_feed.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Redistribute available supply among Livestock_cat based on their demand — redistribute_feed","text":"","code":"if (FALSE) { # \\dontrun{ library(afsetools) load_general_data()  Feed_intake <- redistribute_feed(   Feed_demand = Feed_demand_ygiac |>     dplyr::mutate(fixed_demand = TRUE),   Feed_avail = Feed_avail_ygi ) } # }"},{"path":"https://eduaguilera.github.io/afsetools/reference/regions_full.html","id":null,"dir":"Reference","previous_headings":"","what":"Regional Classifications — regions_full","title":"Regional Classifications — regions_full","text":"Country codes regional aggregations geographic analysis.","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/regions_full.html","id":"format","dir":"Reference","previous_headings":"","what":"Format","title":"Regional Classifications — regions_full","text":"data frame geographic information: area_code Country/region code area_name Country/region name region Regional grouping income_group World Bank income classification","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/regions_full.html","id":"source","dir":"Reference","previous_headings":"","what":"Source","title":"Regional Classifications — regions_full","text":"UN, FAO, World Bank classifications","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/residue_use.html","id":null,"dir":"Reference","previous_headings":"","what":"Calculate Residue Use from Crop NPP Data — residue_use","title":"Calculate Residue Use from Crop NPP Data — residue_use","text":"Converts crop residues separate items based use shares, creating product residue entries appropriate classifications.","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/residue_use.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Calculate Residue Use from Crop NPP Data — residue_use","text":"","code":"residue_use(df)"},{"path":"https://eduaguilera.github.io/afsetools/reference/residue_use.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Calculate Residue Use from Crop NPP Data — residue_use","text":"df Data frame Crop_AreaNPP workflow columns: item_cbs, Name_biomass, Use_Share, Residue_MgDM, Prod_ygpit_Mg, Area_ygpit_ha, crop NPP variables","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/residue_use.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Calculate Residue Use from Crop NPP Data — residue_use","text":"Data frame separate rows products residues, :   - Product rows Product_residue = \"Product\"   - Residue rows Product_residue = \"Residue\"   - Residues converted DM FM using Residue_kgDM_kgFM   - Production (Prod_ygpit_Mg) represents used residue mass   - Residues classified using Residues_as_items()","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/residue_use.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Calculate Residue Use from Crop NPP Data — residue_use","text":"function: 1. Preserves original item_cbs item_cbs_crop 2. Joins Biomass_coefs DM/FM conversion factors 3. Calculates used residue mass fresh matter (FM) units 4. Creates residue entries Product_residue = \"Residue\" 5. Sets Area_ygpit_ha NA residues (area-based) 6. Binds product residue rows together 7. Applies residue classification via Residues_as_items() Requires Biomass_coefs object load_general_data() : - Name_biomass, Residue_kgDM_kgFM columns Used Spain_Hist (Crop_AreaNPP.R Scenarios.R) Global (Crop_NPP.R) workflows.","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/residue_use.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Calculate Residue Use from Crop NPP Data — residue_use","text":"","code":"if (FALSE) { # \\dontrun{ crop_npp_data %>%   residue_use() } # }"},{"path":"https://eduaguilera.github.io/afsetools/reference/residues_as_items.html","id":null,"dir":"Reference","previous_headings":"","what":"Classify Residues as CBS Items — residues_as_items","title":"Classify Residues as CBS Items — residues_as_items","text":"Reclassifies biomass residues grazed weeds standardized Commodity Balance Sheet (CBS) items based product type land use.","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/residues_as_items.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Classify Residues as CBS Items — residues_as_items","text":"","code":"residues_as_items(df)"},{"path":"https://eduaguilera.github.io/afsetools/reference/residues_as_items.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Classify Residues as CBS Items — residues_as_items","text":"df Data frame containing columns: Product_residue, Cat_1, LandUse, Herb_Woody, item_cbs","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/residues_as_items.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Classify Residues as CBS Items — residues_as_items","text":"Data frame item_cbs column updated classify residues :   - \"Straw\" cereal pulse residues   - \"Firewood\" woody crops non-cropland herbaceous residues   - \"crop residues\" cropland herbaceous residues   - \"Grassland\" grazed weeds","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/residues_as_items.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Classify Residues as CBS Items — residues_as_items","text":"Classification logic: - Residues Cereals/Pulses → \"Straw\" - Residues woody crops non-cropland → \"Firewood\" - cropland residues → \"crop residues\" - Grazed weeds → \"Grassland\" - Products retain original item_cbs value","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/residues_as_items.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Classify Residues as CBS Items — residues_as_items","text":"","code":"if (FALSE) { # \\dontrun{ biomass_data |>   residues_as_items() } # }"},{"path":"https://eduaguilera.github.io/afsetools/reference/scale_land.html","id":null,"dir":"Reference","previous_headings":"","what":"Scale Land Area by Cropping Intensity — scale_land","title":"Scale Land Area by Cropping Intensity — scale_land","text":"Applies scaling factors land area account cropping intensity differences.","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/scale_land.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Scale Land Area by Cropping Intensity — scale_land","text":"","code":"scale_land()"},{"path":"https://eduaguilera.github.io/afsetools/reference/scale_land.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Scale Land Area by Cropping Intensity — scale_land","text":"data frame scaled land impact values","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/scale_land.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Scale Land Area by Cropping Intensity — scale_land","text":"","code":"if (FALSE) { # \\dontrun{ scaled_land <- scale_land() } # }"},{"path":"https://eduaguilera.github.io/afsetools/reference/summarize_bnf.html","id":null,"dir":"Reference","previous_headings":"","what":"Summarize BNF Results by Crop or Region — summarize_bnf","title":"Summarize BNF Results by Crop or Region — summarize_bnf","text":"Produces concise summary BNF components environmental adjustment factors output calc_bnf component functions. Useful diagnostics, parameter sensitivity analysis, reporting.","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/summarize_bnf.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Summarize BNF Results by Crop or Region — summarize_bnf","text":"","code":"summarize_bnf(x, group_by = \"Name_biomass\")"},{"path":"https://eduaguilera.github.io/afsetools/reference/summarize_bnf.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Summarize BNF Results by Crop or Region — summarize_bnf","text":"x Data frame output calc_bnf() similar, containing BNF result columns. group_by Character vector columns group . Default c(\"Name_biomass\"). Set NULL overall summary.","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/summarize_bnf.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Summarize BNF Results by Crop or Region — summarize_bnf","text":"tibble per-group summaries: n Number observations. total_CropBNF_MgN Sum symbiotic crop BNF. total_WeedsBNF_MgN Sum weed/CC BNF. total_NSBNF_MgN Sum non-symbiotic BNF. total_BNF_MgN Sum total BNF. mean_Ndfa_adj Mean adjusted Ndfa. mean_f_env_symb Mean symbiotic env factor. mean_f_env_ns Mean non-symbiotic env factor. pct_CropBNF Percent total crop. pct_WeedsBNF Percent total weeds. pct_NSBNF Percent total NSBNF.","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/summarize_bnf.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Summarize BNF Results by Crop or Region — summarize_bnf","text":"","code":"if (FALSE) { # \\dontrun{ load_general_data() bnf_results <- npp_data |> calc_bnf() summarize_bnf(bnf_results) summarize_bnf(bnf_results, group_by = c(\"Region\", \"Year\")) } # }"},{"path":"https://eduaguilera.github.io/afsetools/reference/theme_new.html","id":null,"dir":"Reference","previous_headings":"","what":"ggplot2 Themes for Scientific Plots — theme_new","title":"ggplot2 Themes for Scientific Plots — theme_new","text":"Custom ggplot2 themes creating publication-ready scientific figures. Custom ggplot2 Theme","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/theme_new.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"ggplot2 Themes for Scientific Plots — theme_new","text":"","code":"theme_new(base_size = 7, base_family = \"\")"},{"path":"https://eduaguilera.github.io/afsetools/reference/theme_new.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"ggplot2 Themes for Scientific Plots — theme_new","text":"base_size Base font size. Default 7. base_family Base font family. Default \"\".","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/theme_new.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"ggplot2 Themes for Scientific Plots — theme_new","text":"ggplot2 theme object","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/theme_new.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"ggplot2 Themes for Scientific Plots — theme_new","text":"clean theme scientific plots white background minimal grid lines.","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/theme_new.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"ggplot2 Themes for Scientific Plots — theme_new","text":"","code":"if (FALSE) { # \\dontrun{ library(ggplot2) ggplot(mtcars, aes(wt, mpg)) +   geom_point() +   theme_new() } # }"},{"path":"https://eduaguilera.github.io/afsetools/reference/theme_nolabel.html","id":null,"dir":"Reference","previous_headings":"","what":"ggplot2 Theme Without Labels — theme_nolabel","title":"ggplot2 Theme Without Labels — theme_nolabel","text":"theme similar theme_new() strip text removed, useful multi-panel plots.","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/theme_nolabel.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"ggplot2 Theme Without Labels — theme_nolabel","text":"","code":"theme_nolabel(base_size = 7, base_family = \"\")"},{"path":"https://eduaguilera.github.io/afsetools/reference/theme_nolabel.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"ggplot2 Theme Without Labels — theme_nolabel","text":"base_size Base font size. Default 7. base_family Base font family. Default \"\".","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/theme_nolabel.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"ggplot2 Theme Without Labels — theme_nolabel","text":"ggplot2 theme object","code":""},{"path":"https://eduaguilera.github.io/afsetools/reference/theme_nolabel.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"ggplot2 Theme Without Labels — theme_nolabel","text":"","code":"if (FALSE) { # \\dontrun{ library(ggplot2) ggplot(mtcars, aes(wt, mpg)) +   geom_point() +   theme_nolabel() } # }"},{"path":"https://eduaguilera.github.io/afsetools/reference/utility_functions.html","id":null,"dir":"Reference","previous_headings":"","what":"Utility Functions for Data Manipulation — utility_functions","title":"Utility Functions for Data Manipulation — utility_functions","text":"Collection general-purpose utility functions data manipulation, gap-filling, date handling, Excel operations.","code":""}]
